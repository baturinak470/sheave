if(!window.iamInitialized){if(!Array.prototype.find){Object.defineProperty(Array.prototype,'find',{value:function(predicate){'use strict';if(this==null){throw new TypeError('Array.prototype.find called on null or undefined');}if(typeof predicate!=='function'){throw new TypeError('predicate must be a function');}var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];for(var i=0;i!==length;i++){if(predicate.call(thisArg,this[i],i,list)){return this[i];}}return undefined;}});}if(!Array.prototype.filter){Array.prototype.filter=function(fun){'use strict';if(this===void 0||this===null){throw new TypeError();}var t=Object(this);var len=t.length>>>0;if(typeof fun!=='function'){throw new TypeError();}var res=[];var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fun.call(thisArg,val,i,t)){res.push(val);}}}return res;};}if(!Object.keys){Object.keys=(function(){'use strict';var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!({toString:null}).propertyIsEnumerable('toString'),dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],dontEnumsLength=dontEnums.length;return function(obj){if(typeof obj!=='function'&&(typeof obj!=='object'||obj===null)){throw new TypeError('Object.keys called on non-object');}var result=[],prop,i;for(prop in obj){if(hasOwnProperty.call(obj,prop)){result.push(prop);}}if(hasDontEnumBug){for(i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i])){result.push(dontEnums[i]);}}}return result;};}());}if(!Object.entries)Object.entries=function(obj){var ownProps=Object.keys(obj),i=ownProps.length,resArray=new Array(i);while(i--)resArray[i]=[ownProps[i],obj[ownProps[i]]];return resArray;}
if(!Array.prototype.forEach){Array.prototype.forEach=function(callback){var T,k;if(this==null){throw new TypeError('this is null or not defined');}var O=Object(this);var len=O.length>>>0;if(typeof callback!=='function'){throw new TypeError(callback+' is not a function');}if(arguments.length>1){T=arguments[1];}k=0;while(k<len){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O);}k++;}};}if(!Object.assign){Object.defineProperty(Object,'assign',{enumerable:false,configurable:true,writable:true,value:function(target,firstSource){'use strict';if(target===undefined||target===null){throw new TypeError('Cannot convert first argument to object');}var to=Object(target);for(var i=1;i<arguments.length;i++){var nextSource=arguments[i];if(nextSource===undefined||nextSource===null){continue;}nextSource=Object(nextSource);var keysArray=Object.keys(Object(nextSource));for(var nextIndex=0,len=keysArray.length;nextIndex<len;nextIndex++){var nextKey=keysArray[nextIndex];var desc=Object.getOwnPropertyDescriptor(nextSource,nextKey);if(desc!==undefined&&desc.enumerable){to[nextKey]=nextSource[nextKey];}}}return to;}});}if(!String.prototype.endsWith){String.prototype.endsWith=function(search,this_len){if(this_len===undefined||this_len>this.length){this_len=this.length;}return this.substring(this_len-search.length,this_len)===search;};}if(!String.prototype.includes){String.prototype.includes=function(search,start){'use strict';if(typeof start!=='number'){start=0;}if(start+search.length>this.length){return false;}else{return this.indexOf(search,start)!==-1;}};}}IOL=window.IOL||{};if(!window.iamInitialized){IOL.adv={classname:"IOL.adv",version:"2.3.0",server:"//www.iolam.it",domain:"",hasFocus:false,pageWidth:1024,url:((document.URL)?document.URL:''),referrer:((document.referrer)?document.referrer:false),referrerLabel:false,topics:[],complete:false,mode:'standard',connectionType:"4g",downlink:5,trackingMsg:"",deferredIteration:0,deferredMaxIteration:400,deferredInterval:50,deferredTimer:null,pubAdsCfg:{slot:"default",originalSlot:"default",section:"default",prestitial:false,native:false,inread:false,customCriteria:false,prebid:true,lazy:false,deferredDivId:true,deferredDisplay:false,deferredRun:false,profile:true,forceHttps:false,dynamicAds:{enable:false}},gdpr:{enable:false,__cmp:false,cookieName:"euconsent,localconsent",consentData:""},profile:{enable:true,up:{enable:true,remoteHandler:"/up",cookie:{name:"up",duration:30},value:{trk:Math.floor((Math.random()*100)+1),up:false,ppid:false,age:false,gender:false,province:false,ext:{mivedo:false}},comingFrom:"none",resource:{url:""}},as:{enable:true,cookie:{name:"as",duration:30,refresh:86400000},value:{pid:"",audienceId:[]},comingFrom:"none",resource:{url:"//ad.crwdcntrl.net/5/c=6199/pe=y/callback=IOL.adv.setAsCallback"}}},videoAds:{"id":false,"reqCounter":0,"status":'ready',"mode":'get',"adUnitPath":false,"adServerUrl":false,"trueview":{"threshold":999999,"param":false},"hb":{"enable":false,"bidders":[],"complete":false,"timedOut":false},"bob":{}},track:{enable:true&&(typeof window.performance!=='undefined'&&typeof window.performance.now!=='undefined'),remoteHandler:"/trk",percentCustomerBase:5,threshold:3000,startAfter:5000},test:{enable:false,param:"dctestAdv",cookie:{name:"advTest",duration:1},value:false,paramAdUnitVideo:"iu",adUnitVideo:false,slot:"test"},debug:{param:"iam_console",consoleHandler:"/js/cnsl.js",log:null,console:null,lazy:null,prebid:null,prestitial:null,slot:null,native:null,inread:null,deferredDivId:null,deferredDisplay:null,deferredRun:null,pageWidth:null,profile:null},timer:true&&(typeof window.performance!=='undefined'&&typeof window.performance.now!=='undefined'),init:function(fn){var classFunc=IOL.adv.classname+".init";if(IOL.adv.tools.getParameterByName(this.debug.param)){try{var debug=JSON.parse(IOL.adv.tools.getParameterByName(this.debug.param));this.debug.log=true&&(typeof window.console!=='undefined')&&((typeof debug.log!=='undefined')?debug.log:false);this.debug.console=(typeof debug.console!=='undefined')?debug.console:false;this.debug.lazy=(typeof debug.lazy!=='undefined')?debug.lazy:null;this.debug.prebid=(typeof debug.prebid!=='undefined')?debug.prebid:null;this.debug.prestitial=(typeof debug.prestitial!=='undefined')?debug.prestitial:null;this.debug.slot=(typeof debug.slot!=='undefined')?debug.slot:null;this.debug.native=(typeof debug.native!=='undefined')?debug.native:null;this.debug.inread=(typeof debug.inread!=='undefined')?debug.inread:null;this.debug.deferredDivId=(typeof debug.deferredDivId!=='undefined')?debug.deferredDivId:null;this.debug.deferredDisplay=(typeof debug.deferredDisplay!=='undefined')?debug.deferredDisplay:null;this.debug.deferredRun=(typeof debug.deferredRun!=='undefined')?debug.deferredRun:null;this.debug.pageWidth=(typeof debug.pageWidth!=='undefined')?debug.pageWidth:null;this.debug.profile=(typeof debug.profile!=='undefined')?debug.profile:null;IOL.adv.tools.logger("Debug value: "+JSON.stringify(this.debug),classFunc);}catch(e){console.log("Error parsing mayday parameter, please use the following specs: {\"log\":true,\"console\":true,\"lazy\":true,\"prebid\":false}");}}this.debug.log=(IOL.adv.cookie.get('iamdbg')?true:this.debug.log);IOL.adv.tools.timer("IOL.adv",".grandTotal","start");IOL.adv.tools.timer(classFunc,"Function","start");IOL.adv.tools.logger("Start function",classFunc);this.domain=IOL.adv.tools.getDomain(window.location.host);this.hasFocus=window.document.hasFocus();this.pageWidth=document.documentElement.clientWidth||window.innerWidth;this.referrerLabel=IOL.adv.tools.getReferrerLabel(this.referrer,'other');this.topics=IOL.adv.tools.getMetaTag('keywords',',');window.grumi={cfg:{advs:{},pubIds:{}},key:'4415fe16-b37d-46de-ac5c-69d63c72d5ee'};if(typeof navigator.connection!=='undefined'){this.connectionType=navigator.connection.effectiveType;this.downlink=navigator.connection.downlink;}IOL.adv.tools.logger("domain: "+this.domain+", focus: "+this.hasFocus+", connectionType: "+this.connectionType+", downlink: "+this.downlink,classFunc);if(typeof window.pubAdsCfg!=='undefined'){IOL.adv.tools.logger("Parse pubAdsCfg",classFunc);IOL.adv.pubAdsCfg.slot=(window.pubAdsCfg.slot)?window.pubAdsCfg.slot:"default";IOL.adv.pubAdsCfg.originalSlot=IOL.adv.pubAdsCfg.slot;IOL.adv.pubAdsCfg.section=(window.pubAdsCfg.section)?window.pubAdsCfg.section.toLowerCase():"default";IOL.adv.pubAdsCfg.native=(window.pubAdsCfg.native)?window.pubAdsCfg.native:false;IOL.adv.pubAdsCfg.inread=(window.pubAdsCfg.inread)?window.pubAdsCfg.inread:false;IOL.adv.pubAdsCfg.customCriteria=(window.pubAdsCfg.customCriteria)?window.pubAdsCfg.customCriteria:false;IOL.adv.pubAdsCfg.prebid=(typeof window.pubAdsCfg.prebid!=='undefined')?window.pubAdsCfg.prebid:true;IOL.adv.pubAdsCfg.prestitial=(window.pubAdsCfg.prestitial)?window.pubAdsCfg.prestitial:false;IOL.adv.pubAdsCfg.deferredDivId=(typeof window.pubAdsCfg.deferredDivId!=='undefined')?window.pubAdsCfg.deferredDivId:true;IOL.adv.pubAdsCfg.deferredDisplay=(typeof window.pubAdsCfg.deferredDisplay!=='undefined')?window.pubAdsCfg.deferredDisplay:false;IOL.adv.pubAdsCfg.deferredRun=(typeof window.pubAdsCfg.deferredRun!=='undefined')?window.pubAdsCfg.deferredRun:false;IOL.adv.pubAdsCfg.lazy=(typeof window.pubAdsCfg.lazy!=='undefined')?window.pubAdsCfg.lazy:false;IOL.adv.pubAdsCfg.profile=(typeof window.pubAdsCfg.profile!=='undefined')?window.pubAdsCfg.profile:true;IOL.adv.pubAdsCfg.forceHttps=(typeof window.pubAdsCfg.forceHttps!=='undefined')?window.pubAdsCfg.forceHttps:false;IOL.adv.pubAdsCfg.dynamicAds=(typeof window.pubAdsCfg.dynamicAds!=='undefined')?window.pubAdsCfg.dynamicAds:{enable:false};}else
window.pubAdsCfg={};if(this.debug.lazy!==null)IOL.adv.pubAdsCfg.lazy=this.debug.lazy;if(this.debug.prebid!==null)IOL.adv.pubAdsCfg.prebid=this.debug.prebid;if(this.debug.prestitial!==null)IOL.adv.pubAdsCfg.prestitial=this.debug.prestitial;if(this.debug.native!==null)IOL.adv.pubAdsCfg.native=this.debug.native;if(this.debug.inread!==null)IOL.adv.pubAdsCfg.inread=this.debug.inread;if(this.debug.slot!==null)IOL.adv.pubAdsCfg.slot=this.debug.slot;if(this.debug.deferredDivId!==null)IOL.adv.pubAdsCfg.deferredDivId=this.debug.deferredDivId;if(this.debug.deferredDisplay!==null)IOL.adv.pubAdsCfg.deferredDisplay=this.debug.deferredDisplay;if(this.debug.deferredRun!==null)IOL.adv.pubAdsCfg.deferredRun=this.debug.deferredRun;if(this.debug.pageWidth!==null)IOL.adv.pageWidth=this.debug.pageWidth;if(this.debug.profile!==null)IOL.adv.pubAdsCfg.profile=this.debug.profile;if(IOL.adv.pubAdsCfg.deferredRun){IOL.adv.pubAdsCfg.deferredDivId=false;IOL.adv.pubAdsCfg.deferredDisplay=true;}IOL.adv.test.value=(IOL.adv.tools.getParameterByName(IOL.adv.test.param))?IOL.adv.tools.getParameterByName(IOL.adv.test.param):IOL.adv.cookie.get(IOL.adv.test.cookie.name);if(IOL.adv.test.value!==false){switch(IOL.adv.test.value){case"0":case"off":IOL.adv.cookie.erase(IOL.adv.test.cookie.name);IOL.adv.tools.logger("Disable test on this properties with value: "+IOL.adv.test.value,classFunc);break;default:IOL.adv.test.enable=true;IOL.adv.cookie.set(IOL.adv.test.cookie.name,IOL.adv.test.value,IOL.adv.test.cookie.duration);IOL.adv.pubAdsCfg.slot=IOL.adv.test.slot+((IOL.adv.pubAdsCfg.slot!=='default')?"_"+IOL.adv.pubAdsCfg.slot:"");IOL.adv.test.adUnitVideo=(IOL.adv.tools.getParameterByName(IOL.adv.test.paramAdUnitVideo))?IOL.adv.tools.getParameterByName(IOL.adv.test.paramAdUnitVideo):false;if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo&&IOL.adv.test.adUnitVideo)IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo.adUnitPath=IOL.adv.test.adUnitVideo;IOL.adv.tools.logger("Enable test on this properties with value: "+IOL.adv.test.value+", adUnitVideo: "+IOL.adv.test.adUnit,classFunc);IOL.adv.tools.logger("Client Slot: "+IOL.adv.pubAdsCfg.originalSlot+", Runtime Slot: "+IOL.adv.pubAdsCfg.slot,classFunc);break;}}IOL.adv.test.enable=IOL.adv.test.enable||(IOL.adv.pubAdsCfg.slot==IOL.adv.test.slot);if(IOL.adv.test.enable)IOL.adv.test.value=(IOL.adv.test.value)?IOL.adv.test.value:"1";if(IOL.adv.pubAdsCfg.prestitial===true){IOL.adv.tools.logger("Prestitial is requested, check frequency cap.",classFunc);if(typeof IOL.adv.settings.ifPrestitial==='function'){if(IOL.adv.settings.ifPrestitial()){IOL.adv.pubAdsCfg.originalSlot=IOL.adv.pubAdsCfg.slot;IOL.adv.pubAdsCfg.slot="prestitial";IOL.adv.tools.logger("Prestitial enabled, override Runtime Slot with \""+IOL.adv.pubAdsCfg.slot+"\"",classFunc);if(IOL.adv.test.enable)IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.adprestitial.adUnitPath=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.adprestitial.adUnitPathTest.replace("%PLACEHOLDER%",IOL.adv.test.value);IOL.adv.tools.logger("prestitial adUnitPath: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.adprestitial.adUnitPath,classFunc);IOL.adv.pubAdsCfg.prebid=false;IOL.adv.pubAdsCfg.lazy=false;}else{IOL.adv.pubAdsCfg.prestitial=false;IOL.adv.tools.logger("Prestitial disable by ifPrestitial",classFunc);}}else{IOL.adv.pubAdsCfg.prestitial=false;IOL.adv.tools.logger("Prestitial disable, IOL.adv.settings.ifPrestitial function in not implemented but is required.",classFunc);}}IOL.adv.tools.logger("Client  pubAdsCfg: "+JSON.stringify(window.pubAdsCfg),classFunc);IOL.adv.tools.logger("Runtime pubAdsCfg: "+JSON.stringify(IOL.adv.pubAdsCfg),classFunc);IOL.adv.setGDPR();IOL.adv.setProfile();if(IOL.adv.settings.percentCustomerBase)IOL.adv.track.percentCustomerBase=IOL.adv.settings.percentCustomerBase;IOL.adv.tools.logger("Evaluate Tracking, track.enable value "+IOL.adv.track.enable+" on "+IOL.adv.track.percentCustomerBase+"% of Customer Base, track cookie value is: "+IOL.adv.profile.up.value.trk,classFunc);IOL.adv.track.enable=(IOL.adv.track.enable&&IOL.adv.profile.up.value.trk<=IOL.adv.track.percentCustomerBase)?true:false;IOL.adv.tools.logger("Tracking: "+IOL.adv.track.enable,classFunc);IOL.adv.tools.logger("Requested Slot: "+IOL.adv.pubAdsCfg.slot,classFunc);if(typeof IOL.adv.settings=='undefined'||IOL.adv.settings.error){IOL.adv.pubAdsCfg.status='Error';IOL.adv.trackingMsg=IOL.adv.version+"::"+classFunc+"::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::::nameSpaceError::";IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.track.remoteHandler,"d="+IOL.adv.domain+"&lv=error&msg="+IOL.adv.trackingMsg);IOL.adv.tools.logger(IOL.adv.trackingMsg,'',"error");return;}if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot]){IOL.adv.manager.trackingMsg=IOL.adv.version+"::"+classFunc+"::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::::slotDoesNotExist";IOL.adv.tools.logger(IOL.adv.manager.trackingMsg,classFunc,"error");IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.track.remoteHandler,"d="+IOL.adv.domain+"&lv=error&msg="+IOL.adv.manager.trackingMsg);return;}Object.keys(IOL.adv.settings.library).forEach(function(key){IOL.adv.tools.logger("Start manage library: "+IOL.adv.settings.library[key].url,classFunc);if(IOL.adv.settings.library[key].enable)if(IOL.adv.settings.library[key].condition){IOL.adv.tools.logger("Start apply condition : "+IOL.adv.settings.library[key].condition+", condition eval: "+eval(IOL.adv.settings.library[key].condition),classFunc);IOL.adv.settings.library[key].enable=eval(IOL.adv.settings.library[key].condition);}IOL.adv.tools.logger("Status of library: "+IOL.adv.settings.library[key].url+", enable: "+IOL.adv.settings.library[key].enable+", mandatory: "+IOL.adv.settings.library[key].mandatory+", condition: "+IOL.adv.settings.library[key].condition,classFunc);IOL.adv.tools.timer(classFunc,IOL.adv.settings.library[key].url,"start");if(IOL.adv.settings.library[key].enable&&IOL.adv.settings.library[key].url!==''){IOL.adv.tools.timer(classFunc,IOL.adv.settings.library[key].url,"start");IOL.adv.tools.loadJs(IOL.adv.settings.library[key].url,function(){IOL.adv.settings.library[key].live=true;IOL.adv.settings.library[key].status="error";IOL.adv.settings.library[key].duration=IOL.adv.tools.timer(classFunc,IOL.adv.settings.library[key].url,"partial");IOL.adv.trackingMsg=IOL.adv.version+"::"+classFunc+"::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::"+IOL.adv.settings.library[key].url+"::resourceLoadingError::"+IOL.adv.settings.library[key].duration;IOL.adv.tools.logger(IOL.adv.trackingMsg,classFunc,"error");if(IOL.adv.track.enable)IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.track.remoteHandler,"d="+IOL.adv.domain+"&lv=error&msg="+IOL.adv.trackingMsg);},function(){IOL.adv.settings.library[key].live=true;IOL.adv.settings.library[key].status="loaded";IOL.adv.settings.library[key].duration=IOL.adv.tools.timer(classFunc,IOL.adv.settings.library[key].url,"partial");IOL.adv.tools.logger("Time elapsed for loading "+IOL.adv.settings.library[key].url+" is "+IOL.adv.settings.library[key].duration,classFunc);},(IOL.adv.settings.library[key].id)?IOL.adv.settings.library[key].id:false);}});IOL.adv.deferredTimer=setInterval(function(){IOL.adv.deferredLibLoading(fn);},IOL.adv.deferredInterval);IOL.adv.tools.logger("End Function. Time elapsed is: "+IOL.adv.tools.timer(classFunc,"Function","partial"),classFunc);},setGDPR:function(){var classFunc=IOL.adv.classname+".setGDPR";IOL.adv.gdpr.cookieName=((IOL.adv.settings.consentCookieName)?IOL.adv.settings.consentCookieName:IOL.adv.gdpr.cookieName);var consentData=IOL.adv.cookie.get(IOL.adv.gdpr.cookieName);IOL.adv.tools.logger("GDPR, consentData: "+consentData+" from cookie: "+IOL.adv.gdpr.cookieName,classFunc);if(consentData){IOL.adv.gdpr.enable=true;IOL.adv.gdpr.consentData=consentData;}if(typeof window.__cmp==='undefined'){IOL.adv.tools.logger("GDPR, __cmp object is not defined",classFunc);if(consentData){IOL.adv.tools.logger("GDPR, __cmp object is not defined but euconsent cookie exist, create __cmp object on the fly",classFunc);IOL.adv.gdpr.__cmp=true;var iabConsentData;var gdprApplies=true;var hasGlobalScope;var responseCode;var cmpLoaded;(function(window,document){function addFrame(){if(window.frames['__cmpLocator'])return;if(document.body){var body=document.body,iframe=document.createElement('iframe');iframe.name='__cmpLocator';iframe.style.display='none';body.appendChild(iframe);}else{setTimeout(addFrame,5);}}addFrame();function cmpMsgHandler(event){try{var json=event.data;var msgIsString=typeof json==="string";if(msgIsString){json=JSON.parse(json);}var call=json.__cmpCall;if(call){window.__cmp(call.command,call.parameter,function(retValue,success){var returnMsg={__cmpReturn:{returnValue:retValue,success:success,callId:call.callId}};event.source.postMessage(msgIsString?JSON.stringify(returnMsg):returnMsg,'*');});}}catch(e){}}var cmpFunc=function(command,version,callback){if(command==='ping'){callback({gdprAppliesGlobally:gdprApplies,cmpLoaded:cmpLoaded},responseCode);}else if(command==='getConsentData'){callback({consentData:(IOL.adv.cookie.get(IOL.adv.gdpr.cookieName)?IOL.adv.cookie.get(IOL.adv.gdpr.cookieName):""),gdprApplies:gdprApplies,hasGlobalScope:hasGlobalScope},responseCode);}else if(command==='getVendorConsents'){callback({metadata:iabConsentData,gdprApplies:gdprApplies,hasGlobalScope:hasGlobalScope},responseCode);}else{callback(undefined,false);}};if(typeof(__cmp)!=='function'){window.__cmp=cmpFunc;window.__cmp.msgHandler=cmpMsgHandler;if(window.addEventListener){window.addEventListener('message',cmpMsgHandler,false);}else{window.attachEvent('onmessage',cmpMsgHandler);}}})(window,document);}}else{IOL.adv.gdpr.__cmp=true;IOL.adv.tools.logger("GDPR, __cmp object is defined",classFunc);}if(IOL.adv.gdpr.__cmp)window.__cmp('getConsentData',null,function(result){IOL.adv.tools.logger("__cmp.getConsentData, result: "+result.consentData,classFunc);if(result.consentData!==''){IOL.adv.gdpr.enable=true;IOL.adv.gdpr.consentData=result.consentData;IOL.adv.tools.logger("GDPR enable: "+IOL.adv.gdpr.enable+", consentData: "+IOL.adv.gdpr.consentData,classFunc);}});},setProfile:function(){var classFunc=IOL.adv.classname+".setProfile";IOL.adv.tools.timer(classFunc,"Function","start");IOL.adv.tools.logger("Start function",classFunc);var doNotTrack=false;var profilingCookiePolicy=IOL.adv.cookie.getProfileEnable('Advertising');IOL.adv.profile.enable=profilingCookiePolicy&&!doNotTrack&&IOL.adv.pubAdsCfg.profile;IOL.adv.tools.logger("User Profiling enabled: ["+IOL.adv.profile.enable+"] DoNotTrack ["+doNotTrack+"], profilingCookiePolicy ["+profilingCookiePolicy+"]",classFunc);if(IOL.adv.profile.enable){IOL.adv.profile.up.enable=((IOL.adv.settings.enableUserProfiling!==false)?true:false);if(IOL.adv.profile.up.enable)IOL.adv.setUp();IOL.adv.profile.as.enable=((IOL.adv.settings.enableAudience!==false)?true:false);if(IOL.adv.profile.as.enable)IOL.adv.setAs();}else
IOL.adv.delProfile('light');window.adv_fup=window.adv_fup||{};window.adv_lauds_str=window.adv_lauds_str||[];window.adv_profile=(IOL.adv.profile.enable)?"0":"1";window.adv_fup.sfe=IOL.adv.profile.up.value.age;window.adv_fup.sse=IOL.adv.profile.up.value.gender;window.adv_lauds_str=IOL.adv.profile.as.value.audienceId;IOL.adv.tools.logger("End function, time elapsed is:  "+IOL.adv.tools.timer(classFunc,"Function","partial"),classFunc);},setUp:function(){var classFunc=IOL.adv.classname+".setUp";IOL.adv.tools.timer(classFunc,"Function","start");IOL.adv.tools.logger("Start function",classFunc);IOL.adv.profile.up.resource.url=IOL.adv.server+IOL.adv.profile.up.remoteHandler;var upLocal={value:{trk:Math.floor((Math.random()*100)+1),up:"",ppid:{},ts:"0"}};var cookieValue=IOL.adv.cookie.get(IOL.adv.profile.up.cookie.name);if(cookieValue){try{upLocal.value=JSON.parse(unescape(cookieValue));if(upLocal.value.ppid==undefined)upLocal.value.ppid={};if(upLocal.value.ext==undefined)upLocal.value.ext={mivedo:false};}catch(e){IOL.adv.tools.logger("Error parsing cookie "+IOL.adv.profile.up.cookie.name+", err: "+e.message,classFunc);}IOL.adv.profile.up.value=Object.assign({},upLocal.value);IOL.adv.profile.up.comingFrom="Cookie "+IOL.adv.profile.up.cookie.name;IOL.adv.profile.up.duration=IOL.adv.tools.timer(classFunc,"Function","partial");}IOL.adv.tools.logger("Handle the local user profile calling the remote host: "+IOL.adv.profile.up.resource.url,classFunc);IOL.adv.tools.timer("",IOL.adv.profile.up.resource.url,"start");IOL.adv.tools.remoteCall(IOL.adv.profile.up.resource.url,'d='+IOL.adv.domain+'&a=get&v='+JSON.stringify(upLocal.value),true,function(res){IOL.adv.tools.logger("User Profile returned from remote host: "+res,classFunc);var resObj={};try{resObj=JSON.parse(unescape(res));}catch(e){resObj.cb="";}if(resObj.cb=='set'){IOL.adv.cookie.set(IOL.adv.profile.up.cookie.name,JSON.stringify(resObj.v),IOL.adv.profile.up.cookie.duration);IOL.adv.profile.up.comingFrom="remoteCall";IOL.adv.tools.logger("User profile has been written or refreshed on this properties with value:"+res,classFunc);}else
IOL.adv.tools.logger("User profile, nothing to write or refresh",classFunc);IOL.adv.profile.up.duration=IOL.adv.tools.timer("",IOL.adv.profile.up.resource.url,"partial");});if(IOL.adv.profile.up.value.up){var aUp=IOL.adv.profile.up.value.up.split("-");if(aUp.length>0){IOL.adv.profile.up.value.age=(aUp[0])?aUp[0]:'0';IOL.adv.profile.up.value.gender=(aUp[1])?aUp[1]:'0';IOL.adv.profile.up.value.province=(aUp)?aUp[2]:'0';IOL.adv.tools.logger("up value :: "+"profile.value.age: "+IOL.adv.profile.up.value.age+" profile.value.gender: "+IOL.adv.profile.up.value.gender+" profile.value.province: "+IOL.adv.profile.up.value.province+" :: coming from: "+IOL.adv.profile.up.comingFrom,classFunc);}}IOL.adv.tools.logger("User Profile final object value: "+JSON.stringify(IOL.adv.profile.up.value)+", comingFrom: "+IOL.adv.profile.up.comingFrom,classFunc);IOL.adv.tools.logger("End function, time elapsed is:  "+IOL.adv.tools.timer(classFunc,"Function","partial"),classFunc);},setAs:function(res){var classFunc=IOL.adv.classname+".setAs";IOL.adv.tools.timer(classFunc,"Function","start");IOL.adv.tools.timer("",IOL.adv.profile.as.resource.url,"start");IOL.adv.tools.logger("Start function",classFunc);var refresh=false;if(IOL.adv.cookie.get(IOL.adv.profile.as.cookie.name)){IOL.adv.profile.as.value=JSON.parse(unescape(IOL.adv.cookie.get(IOL.adv.profile.as.cookie.name)));IOL.adv.profile.as.comingFrom="Cookie";IOL.adv.profile.as.duration=IOL.adv.tools.timer("",IOL.adv.profile.as.resource.url,"partial");IOL.adv.tools.logger("User Profile Audience value: "+JSON.stringify(IOL.adv.profile.as.value)+" comingFrom: "+IOL.adv.profile.as.comingFrom,classFunc);if(!IOL.adv.profile.as.value.ts)IOL.adv.profile.as.value.ts=0;if((Date.now()-IOL.adv.profile.as.value.ts)>IOL.adv.profile.as.cookie.refresh)refresh=true;}else
refresh=true;if(refresh){IOL.adv.tools.logger("Start loading or refresh audience calling the url: "+IOL.adv.profile.as.resource.url,classFunc);IOL.adv.tools.loadJs(IOL.adv.profile.as.resource.url,function(){IOL.adv.profile.as.resource.status="error";IOL.adv.profile.as.duration=IOL.adv.tools.timer("",IOL.adv.profile.as.resource.url,"partial");IOL.adv.trackingMsg=IOL.adv.version+"::"+classFunc+"::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::"+IOL.adv.profile.as.resource.url+"::resourceLoadingError::"+IOL.adv.profile.as.duration;IOL.adv.tools.logger(IOL.adv.trackingMsg,'',"error");if(IOL.adv.track.enable)IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.track.remoteHandler,"d="+IOL.adv.domain+"&lv=error&msg="+IOL.adv.trackingMsg);});}IOL.adv.tools.logger("End function, time elapsed is:  "+IOL.adv.tools.timer(classFunc,"Function","partial"),classFunc);},setAsCallback:function(res){var classFunc=IOL.adv.classname+".setAsCallback";IOL.adv.tools.logger("User Profile Audience from remoteCall:  "+JSON.stringify(res),classFunc);IOL.adv.profile.as.comingFrom="remoteCall";IOL.adv.profile.as.resource.status="loaded";IOL.adv.profile.as.duration=IOL.adv.tools.timer("",IOL.adv.profile.as.resource.url,"partial");if(res.Profile.pid){IOL.adv.profile.as.value.pid=res.Profile.pid;IOL.adv.profile.as.value.ts=Date.now();var l=res.Profile.Audiences.Audience.length;if(l>0){for(var i=0;i<l;i++){IOL.adv.profile.as.value.audienceId[i]=res.Profile.Audiences.Audience[i].id;}IOL.adv.cookie.set(IOL.adv.profile.as.cookie.name,JSON.stringify(IOL.adv.profile.as.value),IOL.adv.profile.as.cookie.duration);}}IOL.adv.tools.logger("User Profile Audience value: "+JSON.stringify(IOL.adv.profile.as.value)+" comingFrom: "+IOL.adv.profile.as.comingFrom,classFunc);IOL.adv.tools.logger("End function, time elapsed is:  "+IOL.adv.profile.as.duration,classFunc);},delProfile:function(mode){var classFunc=IOL.adv.classname+".delProfile";IOL.adv.tools.timer(classFunc,"Function","start");IOL.adv.tools.logger("Start function",classFunc);IOL.adv.cookie.erase(IOL.adv.profile.up.cookie.name);IOL.adv.cookie.erase(IOL.adv.profile.as.cookie.name);if(mode=='full'){IOL.adv.tools.logger("Start removing cookie also for www.iolam.it calling handler:"+IOL.adv.server+IOL.adv.profile.up.remoteHandler,classFunc);IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.profile.up.remoteHandler,'d='+IOL.adv.domain+'&a=del',true);IOL.adv.tools.logger("End removing cookie also for www.iolam.it",classFunc);}IOL.adv.tools.logger("End function, time elapsed is:  "+IOL.adv.tools.timer(classFunc,"Function","partial"),classFunc);},getConsentData:function(){var classFunc=IOL.adv.classname+".getConsentData";if(IOL.adv.gdpr.consentData==""){IOL.adv.tools.logger("consentData is empty in this time, __cmp is defined. Try to get getConsentData anyway reading euconsent cookie",classFunc);IOL.adv.gdpr.consentData=(IOL.adv.cookie.get(IOL.adv.gdpr.cookieName))?IOL.adv.cookie.get(IOL.adv.gdpr.cookieName):""}IOL.adv.tools.logger("return consentData: "+IOL.adv.gdpr.consentData,classFunc);return IOL.adv.gdpr.consentData;},__cmpExist:function(){var classFunc=IOL.adv.classname+".__cmpExist";IOL.adv.tools.logger("return __cmpExist: "+IOL.adv.gdpr.__cmp,classFunc);return IOL.adv.gdpr.__cmp;},isUserProfileEnable:function(){var classFunc=IOL.adv.classname+".isUserProfileEnable";IOL.adv.tools.logger("return isUserProfileEnable: "+IOL.adv.profile.enable,classFunc);return IOL.adv.profile.enable;},getProfile:function(what){var classFunc=IOL.adv.classname+".getProfile";var ret={};IOL.adv.tools.logger("Start function",classFunc);what=(what)?what:"";switch(what){case"age":ret.age=(IOL.adv.profile.up.value.age!==false)?IOL.adv.profile.up.value.age:"0";break;case"gender":ret.gender=((IOL.adv.profile.up.value.gender!==false)?IOL.adv.profile.up.value.gender:"0");break;case"province":ret.province=(IOL.adv.profile.up.value.province!==false)?IOL.adv.profile.up.value.province:"0";break;case"consentData":var consentData=IOL.adv.getConsentData();ret.consentData=(consentData!=="")?consentData:false;break;case"audience":ret.audience=(IOL.adv.profile.as.value!==false)?IOL.adv.profile.as.value:false;break;case"all":default:ret.age=(IOL.adv.profile.up.value.age!==false)?IOL.adv.profile.up.value.age:"0";ret.gender=((IOL.adv.profile.up.value.gender!==false)?IOL.adv.profile.up.value.gender:"0");ret.province=(IOL.adv.profile.up.value.province!==false)?IOL.adv.profile.up.value.province:"0";var consentData=IOL.adv.getConsentData();ret.consentData=(consentData!=="")?consentData:false;ret.audience=(IOL.adv.profile.as.value!==false)?IOL.adv.profile.as.value:false;break;}IOL.adv.tools.logger("getProfile parameter: "+what+", return: "+JSON.stringify(ret),classFunc);IOL.adv.tools.logger("End function",classFunc);return ret;},deferredLibLoading:function(fn){var classFunc=IOL.adv.classname+".deferredLibLoading";var status=true;IOL.adv.tools.logger("deferredLibLoading ::deferredMaxIteration:"+IOL.adv.deferredMaxIteration+", deferredIteration: "+IOL.adv.deferredIteration+", deferredInterval (ms.):"+this.deferredInterval,classFunc);if(IOL.adv.deferredIteration<=IOL.adv.deferredMaxIteration){Object.keys(IOL.adv.settings.library).forEach(function(key){IOL.adv.tools.logger(key+" live: "+IOL.adv.settings.library[key].live+", enable: "+IOL.adv.settings.library[key].enable+((!IOL.adv.settings.library[key].enable)?", library not in use":""),classFunc);status=status&&(IOL.adv.settings.library[key].live||!IOL.adv.settings.library[key].enable);});if(status){IOL.adv.tools.logger("status true:: deferredMaxIteration:"+IOL.adv.deferredMaxIteration+" deferredIteration: "+IOL.adv.deferredIteration,classFunc);clearInterval(IOL.adv.deferredTimer);fn();}else{IOL.adv.deferredIteration++;IOL.adv.tools.logger("status false, retry:: deferredMaxIteration:"+IOL.adv.deferredMaxIteration+" deferredIteration: "+IOL.adv.deferredIteration,classFunc);}}else{clearInterval(IOL.adv.deferredTimer);Object.keys(IOL.adv.settings.library).forEach(function(key){if(IOL.adv.settings.library[key].mandatory&&IOL.adv.settings.library[key].live){IOL.adv.tools.logger("iteration finished. The mandatory lib with key "+key+" returning with status: "+IOL.adv.settings.library[key].live,classFunc);status=true;}if(status){IOL.adv.tools.logger("iteration finished, start with rendering",classFunc);fn();}});IOL.adv.tools.logger("status false, failed:: deferredMaxIteration:"+IOL.adv.deferredMaxIteration+" deferredIteration: "+IOL.adv.deferredIteration,classFunc);}},showConsole:function(fn){if(document.getElementById("3eRbq4M8vffvBuyT")){document.getElementById("3eRbq4M8vffvBuyT").remove();}IOL.adv.tools.loadJs(IOL.adv.server+IOL.adv.debug.consoleHandler);},refreshSlot:function(id,callback,mediaType){var classFunc=IOL.adv.classname+".refreshSlot";var interval=50;var i=setInterval(function(){if(IOL.adv.complete){IOL.adv.tools.logger("refreshSlot requested and IOL.adv.complete is true, run refreshSlotIsReady",classFunc);clearInterval(i);IOL.adv.refreshSlotIsReady(id,callback,mediaType);}else
IOL.adv.tools.logger("refreshSlot requested but IOL.adv.complete is false, please wait...",classFunc);},interval);},refreshSlotIsReady:function(id,callback,mediaType){var classFunc=IOL.adv.classname+".refreshSlotIsReady";IOL.adv.tools.logger("Start function",classFunc);var mediaType=(mediaType)?mediaType:'display';if(mediaType=='display')IOL.adv.mode='refresh';if(IOL.adv.pubAdsCfg.deferredDisplay)IOL.adv.pubAdsCfg.deferredDisplay=false;IOL.adv.manager.refreshSlotsContainer={requested:[],valid:[],slots:[],ads:{},headerBidding:{prebidjs:{adUnits:[]}}};IOL.adv.manager.videoAds=false;IOL.adv.manager.videoOnly=false;if(id){IOL.adv.manager.refreshSlotsContainer.requested=id.split(',').filter(function(e){if(e)return e;});}else
Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(key){IOL.adv.manager.refreshSlotsContainer.requested.push(key);});IOL.adv.manager.refreshSlotsContainer.valid=IOL.adv.manager.refreshSlotsContainer.requested.filter(function(key){if(!IOL.adv.manager.slotsContainer[key]){return false;}var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[key];var refresh=true;if(ad.refresh){if((Date.now()-ad.refresh.ts)>ad.refresh.gap){ad.refresh.ts=Date.now();}else{refresh=false;IOL.adv.tools.logger("Refresh disable for "+key+", refresh gap is not reached yet",classFunc);}}return ad.mediaType==mediaType&&refresh;});if(mediaType=='video'&&IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo)IOL.adv.manager.refreshSlotsContainer.valid.push('advideo');IOL.adv.tools.logger("Requested slots: "+IOL.adv.manager.refreshSlotsContainer.requested.toString()+". Valid slots to refresh: "+IOL.adv.manager.refreshSlotsContainer.valid.toString(),classFunc);IOL.adv.manager.refreshSlotsContainer.valid.forEach(function(key){if(IOL.adv.manager.slotsContainer[key]){IOL.adv.manager.refreshSlotsContainer.slots.push(IOL.adv.manager.slotsContainer[key]);}});Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(key){if(IOL.adv.manager.refreshSlotsContainer.valid.indexOf(key)>=0)IOL.adv.manager.refreshSlotsContainer.ads[key]=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[key];});if(typeof IOL.adv.settings.prebidjs!=='undefined')Object.keys(IOL.adv.manager.refreshSlotsContainer.ads).forEach(function(key){var ad=IOL.adv.manager.refreshSlotsContainer.ads[key];IOL.adv.settings.prebidjs.adUnits.filter(function(e){if(e.code==this.code){IOL.adv.tools.logger("prebidjs.adUnits.filter e.code found: "+e.code,classFunc);IOL.adv.manager.refreshSlotsContainer.headerBidding.prebidjs.adUnits.push(e);return true;}},{code:ad.divId});});IOL.adv.tools.logger("Start headerBidding.init",classFunc);IOL.adv.headerBidding.init(IOL.adv.manager.refreshSlotsContainer.ads,IOL.adv.manager.refreshSlotsContainer.headerBidding.prebidjs.adUnits);if(IOL.adv.headerBidding.enable){IOL.adv.tools.logger("headerBidding is enable, start headerBidding refresh, callback: "+callback,classFunc);IOL.adv.headerBidding.run(callback);}else{if(IOL.adv.manager.refreshSlotsContainer.slots.length>0){IOL.adv.tools.logger("Refresh slots using standard mode",classFunc);IOL.adv.tools.displayAds({slotContainer:IOL.adv.manager.refreshSlotsContainer.slots,mode:"refresh-slots"});try{if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete. HeaderBidding is disable",classFunc);IamCallbackOnComplete();}}catch(e){}}if(callback){callback();IOL.adv.tools.logger("Run callback "+callback,classFunc);}}IOL.adv.tools.logger("End function.",classFunc);},createAds:function(id,divId,callback){var classFunc=IOL.adv.classname+".createAds";callback=(callback)?callback:false;var onDemandSlot="on-demand-ads";if(IOL.adv.test.enable)onDemandSlot="test_".concat(onDemandSlot);if(!IOL.adv.settings.slots[onDemandSlot]){IOL.adv.tools.logger(IOL.adv.pubAdsCfg.slot+" slot is mandatory",classFunc);return;}if(!IOL.adv.settings.slots[onDemandSlot].ads[id]){IOL.adv.tools.logger(id+" is not a defined ads",classFunc);return;}if(IOL.adv.manager.slotsContainer[id]){IOL.adv.tools.logger(id+" is already defined in IOL.adv.manager.slotsContainer, refresh",classFunc);IOL.adv.pubAdsCfg.slot=onDemandSlot;IOL.adv.refreshSlot(id);return;}IOL.adv.pubAdsCfg.slot=onDemandSlot;IOL.adv.tools.logger("Apply new slot: "+IOL.adv.pubAdsCfg.slot,classFunc);IOL.adv.pubAdsCfg.deferredDivId=false;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].divId=divId;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPath=IOL.adv.getAdUnitPath(id);IOL.adv.manager.originalSlotsContainer=Object.assign({},IOL.adv.manager.slotsContainer);IOL.adv.manager.slotsContainer=[];IOL.adv.tools.logger("originalSlotsContainer: "+IOL.adv.manager.originalSlotsContainer,classFunc);IOL.adv.headerBidding.displayAfterSlotSwitch=true;if(IOL.adv.settings.prebidjs.adUnits){IOL.adv.settings.prebidjs.originalAdUnits=IOL.adv.settings.prebidjs.adUnits;IOL.adv.settings.prebidjs.adUnits=[];}if(IOL.adv.settings.prebidjs.onDemandAdUnits){if(IOL.adv.settings.prebidjs.onDemandAdUnits[id]){IOL.adv.tools.logger("prebid dynamic code: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].divId,classFunc);IOL.adv.settings.prebidjs.onDemandAdUnits[id].code=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].divId;IOL.adv.settings.prebidjs.adUnits=[IOL.adv.settings.prebidjs.onDemandAdUnits[id]];}}IOL.adv.manager.init(function(){IOL.adv.manager.run()});googletag.pubads().addEventListener('slotRenderEnded',function(event){if(event.slot.getSlotElementId()==divId){IOL.adv.tools.logger("slotRenderEnded for "+divId+" triggered.",classFunc);IOL.adv.tools.logger("Revert slot and prebid config, extend IOL.adv.manager.slotsContainer with the dynamic",classFunc);IOL.adv.pubAdsCfg.slot=IOL.adv.pubAdsCfg.originalSlot;if(IOL.adv.settings.prebidjs.originalAdUnits)IOL.adv.settings.prebidjs.adUnits=IOL.adv.settings.prebidjs.originalAdUnits;IOL.adv.manager.slotsContainer=IOL.adv.tools.extend(IOL.adv.manager.slotsContainer,IOL.adv.manager.originalSlotsContainer);if(callback){IOL.adv.tools.logger("A callback has been requested, run: "+callback,classFunc);callback();}}});},displaySlot:function(id,callback){var classFunc=IOL.adv.classname+".displaySlot";var slotsContainer={requested:[],slots:[],};if(IOL.adv.pubAdsCfg.deferredDisplay)IOL.adv.pubAdsCfg.deferredDisplay=false;if(id){slotsContainer.requested=id.split(',').filter(function(e){if(e)return e;});}else
Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(key){slotsContainer.requested.push(key);});IOL.adv.tools.logger("Requested slots : "+slotsContainer.requested.toString(),classFunc);slotsContainer.requested.forEach(function(key){if(IOL.adv.manager.slotsContainer[key]){slotsContainer.slots.push(IOL.adv.manager.slotsContainer[key]);IOL.adv.tools.logger(key+" is a valid slot",classFunc);}else
IOL.adv.tools.logger(key+" is not a valid slot",classFunc);});if(IOL.adv.headerBidding.enable)IOL.adv.tools.displayAds({slotContainer:slotsContainer.slots,mode:"refresh-slots"});else
IOL.adv.tools.displayAds({slotId:IOL.adv.manager.lastSlotIdReady,mode:"display-single"});if(callback){IOL.adv.tools.logger("Run callback "+callback,classFunc);callback();}},destroySlot:function(s){var classFunc=IOL.adv.classname+".destroySlot";IOL.adv.tools.logger("Start function",classFunc);IOL.adv.tools.logger("destroySlot request: "+s,classFunc);if(s){var aSlots=s.split(',');aSlots.forEach(function(v){if(IOL.adv.manager.slotsContainer[v]){IOL.adv.tools.logger("start destroySlot for slot: "+v,classFunc);googletag.destroySlots([IOL.adv.manager.slotsContainer[v]]);delete IOL.adv.manager.slotsContainer[v];}else
IOL.adv.tools.logger("slot "+v+" does not exist",classFunc);});}else{IOL.adv.tools.logger("destroySlot for all slots",classFunc);googletag.destroySlots();}IOL.adv.tools.logger("End function",classFunc);},clearSlot:function(s){var classFunc=IOL.adv.classname+".clearSlot";IOL.adv.tools.logger("Start function",classFunc);IOL.adv.tools.logger("clearSlot request: "+s,classFunc);if(s){var aSlots=s.split(',');aSlots.forEach(function(v){if(IOL.adv.manager.slotsContainer[v]){IOL.adv.tools.logger("start clear for slot: "+v,classFunc);googletag.pubads().clear([IOL.adv.manager.slotsContainer[v]]);}else
IOL.adv.tools.logger("slot "+v+" does not exist",classFunc);});}else{IOL.adv.tools.logger("destroySlot for all slots",classFunc);googletag.pubads().clear();}IOL.adv.tools.logger("End function",classFunc);},getAdUnitPath:function(id,provider){var classFunc=IOL.adv.classname+".getAdUnitPath";var r=false;provider=(provider)?provider.toLowerCase():"";try{if(id)if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id]){r=(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPathOverride&&IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPathOverride[provider])?IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPathOverride[provider]:IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPath;if(IOL.adv.pubAdsCfg.section&&IOL.adv.settings.sectionMap)r=(IOL.adv.settings.sectionMap[IOL.adv.pubAdsCfg.section])?r.replace("%SECTION%",IOL.adv.settings.sectionMap[IOL.adv.pubAdsCfg.section]):r.replace("%SECTION%",IOL.adv.settings.sectionMap["default"]);if(typeof _ABTestingTrack!=="undefined")r+="/test"+_ABTestingTrack.toUpperCase();if(IOL.adv.test.enable)r=r.replace("%PLACEHOLDER%",IOL.adv.test.value);}}catch(e){}IOL.adv.tools.logger("adUnitPath for ad: "+id+", provider: "+provider+" is: "+r,classFunc);return r;},setAdUnitPath:function(id,value){var classFunc=IOL.adv.classname+".setAdUnitPath";try{if(id&&value)if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id])IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPath=value;}catch(e){return false;}IOL.adv.tools.logger("adUnitPath for ad: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPath,classFunc);return true;},setAdUnitContent:function(id,o){var classFunc=IOL.adv.classname+".setAdUnitContent";IOL.adv.tools.logger("set content for "+id+": "+o,classFunc);try{if(id&&o){if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id]){IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].content=o;return true;}else{IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].content=false;return false;}}}catch(e){return false;}},setAdSliderContent:function(o){var classFunc=IOL.adv.classname+".setAdSliderContent";IOL.adv.tools.logger("try to set adslider content: "+JSON.stringify(o),classFunc);try{if(o&&IOL.adv.settings.slots.sliderContainer){o.adunit=o.adunit.split('/').pop();IOL.adv.settings.slots.sliderContainer.content.push(o);IOL.adv.tools.logger("adslider content set",classFunc);return true;}}catch(e){return false;}},setUrl:function(u){var classFunc=IOL.adv.classname+".setUrl";IOL.adv.url=u;IOL.adv.tools.logger("IOL.adv.url: "+IOL.adv.url,classFunc);},setVideoAdsTrueViewThreshold:function(v){var classFunc=IOL.adv.classname+".setVideoAdsTrueViewThreshold";if(v)IOL.adv.videoAds.trueview.threshold=v;IOL.adv.tools.logger("trueview.threshold: "+IOL.adv.videoAds.trueview.threshold,classFunc);},getAdUnitContent:function(id){var classFunc=IOL.adv.classname+".getAdUnitContent";var r=false;try{if(id)if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].content)r=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].content;}catch(e){}IOL.adv.tools.logger("get content for "+id+": "+r,classFunc);return r;},getVideoAds:function(provider,callback,options){var classFunc=IOL.adv.classname+".getVideoAds";var interval=50;var id="advideo";var provider=(provider)?provider:"";var options=(options)?options:false;if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo){IOL.adv.tools.logger("advideo slot is not defined",classFunc);IOL.adv.videoAds.status='error';if(callback){IOL.adv.tools.logger("Requested callback "+callback,classFunc);callback(IOL.adv.videoAds);return;}else
return IOL.adv.videoAds;}if(typeof IOL.adv.settings.overrideProvider=='function'){overrideProvider=IOL.adv.settings.overrideProvider();if(overrideProvider){provider=overrideProvider;IOL.adv.tools.logger("Provider overrided with: "+overrideProvider,classFunc);}}IOL.adv.videoAds.adUnitPath=IOL.adv.getAdUnitPath(id,provider);IOL.adv.tools.logger("Requested provider: "+provider+", adUnitPath: "+IOL.adv.videoAds.adUnitPath+", callback: "+callback+", request counter: "+IOL.adv.videoAds.reqCounter,classFunc);if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo.divIdReady)IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo.divIdReady=true;switch(IOL.adv.videoAds.reqCounter){case 0:IOL.adv.videoAds.mode='standard';break;default:IOL.adv.videoAds.mode='refresh';IOL.adv.refreshSlot(id,false,'video');break;}var i=setInterval(function(){if(IOL.adv.headerBidding.requestManager.adServerRequestSent||!IOL.adv.headerBidding.enable){IOL.adv.tools.logger("HeaderBidding done.",classFunc);clearInterval(i);IOL.adv.createVideoAds(provider,callback,options);if(typeof IamCallbackVideoAdsOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackVideoAdsOnComplete in getVideoAds",classFunc);IamCallbackVideoAdsOnComplete();}}else
IOL.adv.tools.logger("HeaderBidding is still running...",classFunc);},interval);},createVideoAds:function(provider,callback,options){var classFunc=IOL.adv.classname+".createVideoAds";var prefixAdServerUrl='https://pubads.g.doubleclick.net/gampad/ads?';var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads.advideo;IOL.adv.videoAds.id=IOL.adv.tools.randomId();IOL.adv.videoAds.status='ready';IOL.adv.videoAds.adServerUrl=false;IOL.adv.videoAds.hb={'enable':false,'bidders':[],'complete':false,'timedOut':false};var up=IOL.adv.getProfile();IOL.adv.videoAds.reqCounter++;IOL.adv.videoAds.trueview.param=((IOL.adv.videoAds.reqCounter<=IOL.adv.videoAds.trueview.threshold)?'&trueview=yes':'&trueview=no');if(options&&ad.optionalFunction){if(ad.optionalFunction[options.args.f]){if(ad.optionalFunction[options.args.f].f){IOL.adv.tools.logger("Run optional func: "+ad.optionalFunction[options.args.f].f,classFunc);eval(ad.optionalFunction[options.args.f].f);}}}IOL.adv.videoAds.adServerUrl=prefixAdServerUrl+'sz=640x480&ciu_szs=&unviewed_position_start=1&gdfp_req=1&impl=s&env=vp&output=vast'+'&iu='+encodeURIComponent(IOL.adv.videoAds.adUnitPath)+'&url=[referrer_url]&correlator=[timestamp]'+'&description_url='+encodeURIComponent(IOL.adv.url)+'&npa='+((IOL.adv.profile.enable)?'0':'1')+'&co='+((IOL.adv.profile.enable)?'0':'1')+'&cust_params='+encodeURIComponent('adv_sso1='+up.age+'&adv_sso2='+up.gender+((up.audience.audienceId.length>0)?'&laud='+up.audience.audienceId.join(','):''))+((IOL.adv.videoAds.trueview.param)?encodeURIComponent(IOL.adv.videoAds.trueview.param):'')+((IOL.adv.topics)?encodeURIComponent('&adv_topics='+IOL.adv.topics.join(',')):'')+((IOL.adv.referrerLabel)?encodeURIComponent('&adv_referrer='+IOL.adv.referrerLabel):'')+((up.consentData)?encodeURIComponent('&gdpr=1&gdpr_consent='+up.consentData):'')+encodeURIComponent('&npa='+((IOL.adv.profile.enable)?'0':'1'))+IOL.adv.headerBidding.getAmazonVideoBid()+IOL.adv.headerBidding.getOnetagVideoBid()+((ad.adServerUrlAppendCustomParams)?encodeURIComponent(ad.adServerUrlAppendCustomParams):'');if(ad.adServerUrlAppendParams)IOL.adv.videoAds.adServerUrl+=ad.adServerUrlAppendParams;if(IOL.adv.headerBidding.prebidjs.enable){var videoAdUnit=IOL.adv.settings.prebidjs.adUnits.find(IOL.adv.headerBidding.findAdunitByMediaType,{'mediaType':'video'});if(videoAdUnit){IOL.adv.tools.logger("Add pbjs bids on video adServerUrl",classFunc);IOL.adv.videoAds.adServerUrl=pbjs.adServers.dfp.buildVideoUrl({adUnit:videoAdUnit,url:IOL.adv.videoAds.adServerUrl,output:'vast'});IOL.adv.tools.logger("Final pbjs video url: "+IOL.adv.videoAds.adServerUrl,classFunc);}}IOL.adv.videoAds.hb.enable=IOL.adv.headerBidding.enable;IOL.adv.videoAds.hb.bidders=IOL.adv.headerBidding.bidders;IOL.adv.videoAds.hb.complete=IOL.adv.headerBidding.requestManager.adServerRequestSent;IOL.adv.videoAds.hb.timedOut=IOL.adv.headerBidding.requestManager.timedOut;IOL.adv.videoAds.status='complete';IOL.adv.tools.logger("Video Ads: "+JSON.stringify(IOL.adv.videoAds),classFunc);if(callback){IOL.adv.tools.logger("Requested callback "+callback,classFunc);callback(IOL.adv.videoAds);}return;},getVideoAdServerUrl:function(){return IOL.adv.videoAds.adServerUrl;}}}if(!window.iamInitialized){IOL.adv.settings={classname:"IOL.adv.settings",ns:"libero.web.notizie.homepage.1.0",enableUserProfiling:true,library:{"geoedge":{enable:true,mandatory:false,url:"//rumcdn.geoedge.be/grumi-ip.js",live:false,condition:"(IOL.adv.pageWidth<=640)"},"platform":{enable:true,mandatory:true,url:"//securepubads.g.doubleclick.net/tag/js/gpt.js",live:false},"prebid":{enable:true,mandatory:false,url:"//www.iolam.it/js/prebid.js",live:false,condition:"IOL.adv.pubAdsCfg.prebid"},"amazon":{enable:true,mandatory:false,url:"//c.amazon-adsystem.com/aax2/apstag.js",live:false,condition:"IOL.adv.pubAdsCfg.prebid"},"quantum":{enable:false,mandatory:false,url:"//cdn.elasticad.net/native/serve/js/quantx/nativeEmbed.gz.js",id:"quantx-embed-tag",live:false,condition:"document.getElementById('adnativeq')!==null"},"intersectionObserver":{enable:true,mandatory:false,url:"//www.iolam.it/js/polyfill/intersection-observer.js",live:false,condition:"typeof IntersectionObserver!=='function' && IOL.adv.pubAdsCfg.lazy"}},disableInitialLoad:true,enableSingleRequest:true,enableAsyncRendering:true,lazy:{observer:{obj:null,options:{threshold:[0.001],rootMargin:"400px 0px 400px 0px"}},divIdSlotIdMap:{}},trackGampad:true,slots:{"default":{fnInit:'IOL.adv.settings.fnInit()',ads:{"admputop":{adUnitPath:"/5180/libero_notizie/hp/top",divId:"admputop",size:[300,250],setCollapseEmptyDiv:[true,true],forceSafeFrame:false,lazy:false,bidAmazon:true,fnBefore:false},"adnative":{adUnitPath:"/5180/libero_notizie/hp/native",divId:"adnative",size:[[220,260],'fluid'],validRangeSize:{"tablet-desktop":{minW:640,maxW:9999}},setCollapseEmptyDiv:[true,true],forceSafeFrame:false,lazy:false,bidAmazon:false,fnBefore:false},"adoutofpage":{adUnitPath:"/5180/libero_notizie/hp/top",outOfPage:true,divId:"adoutofpage",validRangeSize:{"mobile":{minW:0,maxW:640},"desktop":{minW:1200,maxW:9999}},setCollapseEmptyDiv:[true,true],lazy:false,bidAmazon:false,fnBefore:false}},fnFinally:false},"test":{fnInit:'IOL.adv.settings.fnInit()',ads:{"admputop":{adUnitPath:"/5180/testiol/libero/notizie/test%PLACEHOLDER%/top",divId:"admputop",size:[300,250],setCollapseEmptyDiv:[true,true],forceSafeFrame:false,lazy:false,bidAmazon:false,fnBefore:false},"adnative":{adUnitPath:"/5180/testiol/libero/notizie/test%PLACEHOLDER%/native",divId:"adnative",size:[[220,260],'fluid'],validRangeSize:{"tablet-desktop":{minW:640,maxW:9999}},setCollapseEmptyDiv:[true,true],forceSafeFrame:false,lazy:false,bidAmazon:false,fnBefore:false},"adoutofpage":{adUnitPath:"/5180/testiol/libero/notizie/test%PLACEHOLDER%/top",outOfPage:true,divId:"adoutofpage",validRangeSize:{"mobile":{minW:0,maxW:640},"desktop":{minW:1200,maxW:9999}},setCollapseEmptyDiv:[true,true],lazy:false,bidAmazon:false,fnBefore:false}},fnFinally:false}},fnInit:function(){var classFunc=IOL.adv.settings.classname+".fnInit";var extendedCustomCriteria={map:null};var adv_type=[];adv_type.push("resplowrider");if(IOL.adv.pageWidth>=1200)adv_type.push("lowrider");else if(IOL.adv.pageWidth<=640)adv_type.push("moblowrider");if(IOL.adv.pubAdsCfg.inread===true)adv_type.push("inread");if(adv_type.length>0)extendedCustomCriteria.map={"adv_type":{condition:true,value:adv_type}};IOL.adv.manager.customCriteria.map=IOL.adv.tools.extend(IOL.adv.manager.customCriteria.map,extendedCustomCriteria.map);if(IOL.adv.pubAdsCfg.prestitial){IOL.adv.settings.openPrestitial();}},fnFinally:function(){var classFunc=IOL.adv.settings.classname+".fnFinally";}}
function adv_getPrerollAdunit(){return"/5180/libero_notizie/mastheadplayer/video";}IOL.adv.settings.prebidjs={adUnits:[{code:'admputop',sizes:[[300,250]],bids:[{bidder:'appnexus',labelAny:['desktop'],params:{placementId:'12285109'}},{bidder:'appnexus',labelAny:['mobile','tablet'],params:{placementId:'12285113'}},{bidder:'criteo',labelAny:['desktop'],params:{networkId:1994,publisherSubId:'notizie.libero_Desktop_admputop'}},{bidder:'criteo',labelAny:['mobile','tablet'],params:{networkId:1994,publisherSubId:'notizie.libero_MobileWeb_admputop'}},{bidder:'pubmatic',labelAny:['desktop'],params:{publisherId:'83172',adSlot:'1187326@300x250'}},{bidder:'pubmatic',labelAny:['mobile','tablet'],params:{publisherId:'83172',adSlot:'1755327@300x250'}},{bidder:'rubicon',labelAny:['desktop'],params:{accountId:'11334',siteId:'40160',zoneId:'166560',position:'atf'}},{bidder:'rubicon',labelAny:['mobile','tablet'],params:{accountId:'11334',siteId:'158326',zoneId:'754324',position:'btf'}},{bidder:'ix',labelAny:['desktop'],params:{siteId:'394418',size:[300,250]}},{bidder:'ix',labelAny:['mobile','tablet'],params:{siteId:'394419',size:[300,250]}},{bidder:'onetag',labelAny:['desktop','mobile','tablet'],params:{pubId:'389a1a1c29'}},{bidder:'teads',labelAny:['desktop'],params:{pageId:107512,placementId:116784}},{bidder:'teads',labelAny:['mobile','tablet'],params:{pageId:112779,placementId:122596}},{bidder:'improvedigital',labelAny:['desktop'],params:{placementId:22119421}},{bidder:'improvedigital',labelAny:['tablet','mobile'],params:{placementId:22119422}}]}]}}if(!window.iamInitialized){IOL.adv.manager={classname:"IOL.adv.manager",trackingMsg:"",divIdReady:false,slotsContainer:[],refreshSlotsContainer:[],originalSlotsContainer:[],lastSlotIdReady:"",videoAds:false,videoOnly:false,deferredIteration:0,deferredMaxIteration:1000,deferredInterval:20,deferredTimer:null,renderingStartedAt:0.0,customCriteria:{map:{},set:[],duration:""},init:function init(fn){var classFunc=IOL.adv.manager.classname+".init";IOL.adv.tools.timer(classFunc,"Function","start");IOL.adv.tools.logger("Start function",classFunc);try{if(typeof IamCallbackInitialize==="function"){IOL.adv.tools.logger("Hook IamCallbackInitialize",classFunc);IamCallbackInitialize();}}catch(e){}IOL.adv.manager.videoAds=false;IOL.adv.manager.videoOnly=false;if(typeof window.pubAdsCfg!=='undefined'){IOL.adv.pubAdsCfg.section=(window.pubAdsCfg.section)?window.pubAdsCfg.section.toLowerCase():"default";IOL.adv.pubAdsCfg.native=(window.pubAdsCfg.native)?window.pubAdsCfg.native:((IOL.adv.debug.native)?IOL.adv.debug.native:false);IOL.adv.pubAdsCfg.inread=(window.pubAdsCfg.inread)?window.pubAdsCfg.inread:((IOL.adv.debug.inread)?IOL.adv.debug.inread:false);IOL.adv.pubAdsCfg.customCriteria=(window.pubAdsCfg.customCriteria)?window.pubAdsCfg.customCriteria:false;}if(IOL.adv.profile.up.value.ppid.gm&&IOL.adv.profile.enable){IOL.adv.tools.logger("Start refine handler","IOL.adv.refine");window._adftrack=Array.isArray(window._adftrack)?window._adftrack:(window._adftrack?[window._adftrack]:[]);window._adftrack.push({pm:1253522,divider:encodeURIComponent('|'),pagename:encodeURIComponent('nc'),order:{sv1:'1',sv2:'0',sv3:'413',sv4:'0',sv5:IOL.adv.profile.up.value.ppid.gm,sv6:'1',sv7:'true',sv8:'2'}});(function(){var s=document.createElement('script');s.type='text/javascript';s.async=true;s.src='https://track.adform.net/serving/scripts/trackpoint/async/';var x=document.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);})();}if(IOL.adv.pubAdsCfg.dynamicAds.enable)IOL.adv.pubAdsCfg.dynamicAds.id.forEach(function(e,idx){IOL.adv.manager.createAds(e,idx);})
Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(key){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[key];ad.mediaType=(ad.mediaType!==undefined)?ad.mediaType:'display';ad.size=(ad.size==undefined)?[]:ad.size;ad.lazy=(ad.lazy!==undefined)?ad.lazy:true;ad.optional=(ad.optional!==undefined)?ad.optional:false;ad.sizeIsCompliant=true;if(!IOL.adv.pubAdsCfg.deferredDivId&&ad.optional!==true)ad.divIdReady=true;ad.adUnitPath=IOL.adv.getAdUnitPath(key);IOL.adv.tools.logger(key+" :: adUnitPath: "+ad.adUnitPath,classFunc);if(ad.mediaType=='video')ad.size=[[640,480]];IOL.adv.tools.logger(key+" :: ad.size: "+ad.size,classFunc);if(ad.validRangeSize){IOL.adv.tools.logger(key+" :: validRangeSize has been requested",classFunc);IOL.adv.tools.validRangeSize(IOL.adv.pageWidth,ad,key);}if(ad.divIdSwap){IOL.adv.tools.logger(key+" :: divIdSwap has been requested",classFunc);IOL.adv.tools.divIdSwap(IOL.adv.pageWidth,ad,key);}if(ad.mediaType=='video')IOL.adv.manager.videoAds=true;});if(Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).length==1&&IOL.adv.manager.videoAds){IOL.adv.manager.videoOnly=true;IOL.adv.tools.logger("This slot contains a single ads with mediaType video",classFunc);}IOL.adv.tools.logger("deferredDivId is: "+IOL.adv.pubAdsCfg.deferredDivId,classFunc);if(IOL.adv.pubAdsCfg.deferredDivId)IOL.adv.manager.deferredTimer=setInterval(function(){IOL.adv.manager.deferredDivIdReady(fn)},IOL.adv.manager.deferredInterval);else
fn();IOL.adv.tools.logger("End function, Time elapsed is:  "+IOL.adv.tools.timer(classFunc,"Function","partial"),classFunc);},deferredDivIdReady:function(fn){var classFunc=IOL.adv.manager.classname+".deferredDivIdReady";IOL.adv.manager.divIdReady=IOL.adv.tools.divIdsReady(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads);IOL.adv.tools.logger("document.readyState:"+document.readyState+", divIdReady:"+IOL.adv.manager.divIdReady+", deferredMaxIteration:"+IOL.adv.manager.deferredMaxIteration+", deferredIteration: "+IOL.adv.manager.deferredIteration+", deferredInterval (ms.):"+this.deferredInterval,classFunc);if(IOL.adv.manager.deferredIteration<=IOL.adv.manager.deferredMaxIteration){if(IOL.adv.manager.divIdReady||document.readyState!=='loading'){IOL.adv.tools.logger("deferredDivIdReady status true:: deferredMaxIteration:"+IOL.adv.manager.deferredMaxIteration+" deferredIteration: "+IOL.adv.manager.deferredIteration,classFunc);clearInterval(IOL.adv.manager.deferredTimer);fn();}else{IOL.adv.manager.deferredIteration++;IOL.adv.tools.logger("status false, retry:: deferredMaxIteration:"+IOL.adv.manager.deferredMaxIteration+" deferredIteration: "+IOL.adv.manager.deferredIteration,classFunc);}}else{clearInterval(IOL.adv.manager.deferredTimer);fn();IOL.adv.manager.trackingMsg=IOL.adv.version+"::"+classFunc+"::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::::divIdNotReady";IOL.adv.tools.logger(IOL.adv.manager.trackingMsg,classFunc,"error");if(IOL.adv.track.enable)IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.track.remoteHandler,"d="+IOL.adv.domain+"&lv=error&msg="+IOL.adv.manager.trackingMsg);IOL.adv.tools.logger("status false, failed:: deferredMaxIteration:"+IOL.adv.manager.deferredMaxIteration+" deferredIteration: "+IOL.adv.manager.deferredIteration,classFunc);}},run:function(){var classFunc=IOL.adv.manager.classname+".run";if(Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).length>0){if(!IOL.adv.pubAdsCfg.deferredRun&&!IOL.adv.settings.deferredHeaderBiddingInit)IOL.adv.headerBidding.init(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads,((typeof IOL.adv.settings.prebidjs!=='undefined')?IOL.adv.settings.prebidjs.adUnits:false),false);if(IOL.adv.manager.videoOnly){IOL.adv.manager.runVideoOnly();IOL.adv.tools.logger("run in videoOnly mode ",classFunc);}else{IOL.adv.tools.logger("run in display mode and video ( if ads mediaType is video)",classFunc);IOL.adv.manager.runDisplay();}}else
IOL.adv.tools.logger("Nothing to run because there are no ads to display.",classFunc);},runDisplay:function(){var classFunc=IOL.adv.manager.classname+".runDisplay";var googletag=window.googletag||{};googletag.cmd=googletag.cmd||[];googletag.cmd.push(function(){IOL.adv.tools.logger("Start function. ",classFunc);var companionVideo=false;if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit){IOL.adv.tools.logger("Run fnInit on slot: "+IOL.adv.pubAdsCfg.slot+" using function: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit,classFunc);eval(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit);}if(IOL.adv.settings.slots.sliderContainer)if(IOL.adv.settings.slots.sliderContainer.fnInit){IOL.adv.tools.logger("Run fnInit on slot: "+IOL.adv.pubAdsCfg.slot+" using function: "+IOL.adv.settings.slots.sliderContainer.fnInit,classFunc);eval(IOL.adv.settings.slots.sliderContainer.fnInit);}if(Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).length==0){IOL.adv.tools.logger("No ads to display",classFunc);return;}IOL.adv.pubAdsCfg.lazy=IOL.adv.pubAdsCfg.lazy&&(typeof IntersectionObserver==='function'&&typeof IOL.adv.settings.lazy!=='undefined')?true:false;if(IOL.adv.pubAdsCfg.lazy){IOL.adv.settings.enableAsyncRendering=true;IOL.adv.settings.disableInitialLoad=true;IOL.adv.tools.logger("Lazy enable, init IntersectionObserver",classFunc);IOL.adv.settings.lazy.observer.obj=new IntersectionObserver(function onEntry(entries){var l=entries.length;for(var i=0;i<l;i++){var entry=entries[i];IOL.adv.tools.logger("IntersectionObserver: div: "+entry.target.id+", ratio: "+entry.intersectionRatio,classFunc);if(entry.intersectionRatio>0){IOL.adv.tools.logger("IntersectionObserver: "+entry.target.id+" is visible, remove observer, display ads",classFunc);IOL.adv.settings.lazy.observer.obj.unobserve(document.getElementById(entry.target.id));var slotId=IOL.adv.settings.lazy.divIdSlotIdMap[entry.target.id];IOL.adv.tools.displayAds({slotId:slotId,mode:"display-refresh-single",changeCorrelator:false});}}},IOL.adv.settings.lazy.observer.options);}if(IOL.adv.profile.enable){if(IOL.adv.profile.up.value.ppid.iol){googletag.pubads().setPublisherProvidedId(IOL.adv.profile.up.value.ppid.iol);IOL.adv.tools.logger("setPublisherProvidedId: "+IOL.adv.profile.up.value.ppid.iol,classFunc);}}else{googletag.pubads().setCookieOptions(1);googletag.pubads().setRequestNonPersonalizedAds(1);}IOL.adv.settings.disableInitialLoad?googletag.pubads().disableInitialLoad():false;IOL.adv.settings.enableSingleRequest?googletag.pubads().enableSingleRequest():false;IOL.adv.settings.enableAsyncRendering?googletag.pubads().enableAsyncRendering():false;Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){IOL.adv.tools.logger("Start manage ads "+id,classFunc);var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];if(ad.fnBefore){IOL.adv.tools.logger(id+" run fnBefore",classFunc);eval(ad.fnBefore);}if(IOL.adv.pubAdsCfg.lazy&&ad.lazy!==false){ad.setCollapseEmptyDiv=[false,false];}if(ad.sizeIsCompliant&&ad.divIdReady!==true)ad.divIdReady=IOL.adv.tools.divIdReady(ad);if(ad.divIdReady){if(ad.mediaType==='display'){IOL.adv.tools.logger(ad.divId+" is ready, run googletag defineSlot",classFunc);IOL.adv.manager.lastSlotIdReady=id;if(ad.outOfPage)IOL.adv.manager.slotsContainer[id]=googletag.defineOutOfPageSlot(ad.adUnitPath.trim(),ad.divId).addService(googletag.pubads());else{IOL.adv.manager.slotsContainer[id]=googletag.defineSlot(ad.adUnitPath.trim(),ad.size,ad.divId).addService(googletag.pubads());}if(ad.companionVideo){IOL.adv.tools.logger("Ads settings of "+id+" :: companionVideo: "+ad.companionVideo,classFunc);companionVideo=true;IOL.adv.manager.slotsContainer[id].addService(googletag.companionAds());}if(IOL.adv.settings.adomikOptimizer){window.Adomik=window.Adomik||{};Adomik.randomAdGroup=function(){var rand=Math.random();switch(false){case!(rand<0.09):return"ad_ex"+(Math.floor(100*rand));case!(rand<0.10):return"ad_bc";default:return"ad_opt";}};IOL.adv.manager.slotsContainer[id].setTargeting('ad_group',Adomik.randomAdGroup()).setTargeting('ad_h',(new Date).getUTCHours());}ad.setCollapseEmptyDiv?IOL.adv.manager.slotsContainer[id].setCollapseEmptyDiv(ad.setCollapseEmptyDiv[0],ad.setCollapseEmptyDiv[1]):false;if(ad.sizeMapping){IOL.adv.tools.logger("Start define sizeMapping for "+ad.divId,classFunc);var sizeMapping=googletag.sizeMapping();Object.keys(ad.sizeMapping).forEach(function(dimension){IOL.adv.tools.logger(ad.divId+" enable sizeMapping for dimension: "+dimension+" with size: "+ad.sizeMapping[dimension][0]+" :: "+ad.sizeMapping[dimension][1],classFunc);sizeMapping.addSize(ad.sizeMapping[dimension][0],ad.sizeMapping[dimension][1]);});if(sizeMapping)IOL.adv.manager.slotsContainer[id].defineSizeMapping(sizeMapping.build());}if(ad.forceSafeFrame)googletag.pubads().setForceSafeFrame(true);}if(ad.fnAfter){IOL.adv.tools.logger(ad.divId+" run fnAfter",classFunc);eval(ad.fnAfter);}}else{IOL.adv.tools.logger(ad.divId+" is not ready",classFunc);if(ad.sizeIsCompliant){if(ad.mediaType=='display')if(ad.optional!==true&&ad.divId!==''){IOL.adv.tools.logger(ad.divId+" is not ready",classFunc,"error");IOL.adv.manager.trackingMsg=IOL.adv.version+"::"+classFunc+"::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::"+ad.divId+"::divIdDoesNotExist";if(IOL.adv.track.enable)IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.track.remoteHandler,"d="+IOL.adv.domain+"&lv=error&msg="+IOL.adv.manager.trackingMsg);}}else{IOL.adv.tools.logger(ad.divId+" is not in a valid range size",classFunc);}}});IOL.adv.tools.logger("Run setCustomCriteria",classFunc);IOL.adv.manager.setCustomCriteria(googletag);if(companionVideo){googletag.companionAds().setRefreshUnfilledSlots(true);googletag.pubads().enableVideoAds();}IOL.adv.tools.logger("Run googletag.enableServices",classFunc);googletag.enableServices();if(IOL.adv.headerBidding.enable){IOL.adv.tools.logger("Call function prebid.run",classFunc);IOL.adv.headerBidding.run();}else{if(IOL.adv.pubAdsCfg.lazy){IOL.adv.tools.logger("Start Lazy loading in standard mode",classFunc);Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];if(ad.lazy==false){IOL.adv.tools.logger(ad.divId+", lazy disable for this ads, start display",classFunc);IOL.adv.tools.displayAds({slotId:id,mode:"refresh-single",changeCorrelator:false});}else{IOL.adv.tools.logger(ad.divId+", lazy enabled for this ads, start intersectionObserver",classFunc);var d=IOL.adv.tools.divIdReady(ad,true);if(d){IOL.adv.settings.lazy.observer.obj.observe(d);IOL.adv.settings.lazy.divIdSlotIdMap[ad.divId]=id;}}});}else{IOL.adv.tools.logger("Ads start displayAds in standard mode for slot: "+IOL.adv.pubAdsCfg.slot,classFunc);IOL.adv.tools.displayAds({mode:"display-slots"});}try{if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete. HeaderBidding is disable",classFunc);IamCallbackOnComplete();}}catch(e){}}try{googletag.pubads().addEventListener('slotRenderEnded',function(event){if(IOL.adv.track.enable){if(IOL.adv.settings.trackGampad){var e=window.performance.getEntries();IOL.adv.tools.logger("slotRenderEnded, trackGampad: "+IOL.adv.settings.trackGampad,classFunc);for(var i in e){if(e[i].name.indexOf('securepubads.g.doubleclick.net/gampad')!=-1){IOL.adv.settings.trackGampad=false;IOL.adv.trackingMsg=IOL.adv.version+"::"+classFunc+".onGampadStartTime::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::::time.gampad.startTime::"+Math.floor(e[i].startTime);IOL.adv.tools.logger(IOL.adv.trackingMsg,classFunc);IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.track.remoteHandler,"d="+IOL.adv.domain+"&lv=debug&msg="+IOL.adv.trackingMsg);}}}IOL.adv.trackingMsg=IOL.adv.version+"::"+classFunc+".onSlotRenderEnded::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::"+event.slot.getSlotElementId()+"::time.rendering::"+IOL.adv.tools.timer("","","elapsed");IOL.adv.tools.logger(IOL.adv.trackingMsg,classFunc);IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.track.remoteHandler,"d="+IOL.adv.domain+"&lv=debug&msg="+IOL.adv.trackingMsg);}if(typeof IamCallbackSlotRenderEnded==="function"){IOL.adv.tools.logger("Hook IamCallbackSlotRenderEnded for "+event.slot.getSlotElementId(),classFunc);IamCallbackSlotRenderEnded();}});}catch(e){}if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnFinally){IOL.adv.tools.logger("Run fnFinally on slot: "+IOL.adv.pubAdsCfg.slot+" using function: "+IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnFinally,classFunc);eval(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnFinally);}if(IOL.adv.settings.slots.sliderContainer)if(IOL.adv.settings.slots.sliderContainer.fnFinally){IOL.adv.tools.logger("Run fnFinally on slot: "+IOL.adv.pubAdsCfg.slot+" using function: "+IOL.adv.settings.slots.sliderContainer.fnFinally,classFunc);eval(IOL.adv.settings.slots.sliderContainer.fnFinally);}if(IOL.adv.track.enable)IOL.adv.tools.track();if(IOL.adv.debug.console)IOL.adv.showConsole();IOL.adv.complete=true;IOL.adv.tools.logger("End function. ",classFunc);});},runVideoOnly:function(){var classFunc=IOL.adv.manager.classname+".runVideoOnly";IOL.adv.tools.logger("Start function. ",classFunc);if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit){IOL.adv.tools.logger("Run fnInit on slot: "+IOL.adv.pubAdsCfg.slot,classFunc);eval(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnInit);}Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){IOL.adv.tools.logger("Start manage ads "+id,classFunc);var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];if(ad.fnBefore){IOL.adv.tools.logger(id+" run fnBefore",classFunc);eval(ad.fnBefore);}if(ad.fnAfter){IOL.adv.tools.logger(ad.divId+" run fnAfter",classFunc);eval(ad.fnAfter);}});if(IOL.adv.headerBidding.enable){IOL.adv.tools.logger("Call function prebid.run",classFunc);IOL.adv.headerBidding.run();}if(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnFinally){IOL.adv.tools.logger("Run fnFinally on slot: "+IOL.adv.pubAdsCfg.slot,classFunc);eval(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].fnFinally);}if(!IOL.adv.headerBidding.enable){try{if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete in sendAdserverRequest",classFunc);IamCallbackOnComplete();}}catch(e){}}if(IOL.adv.debug.console)IOL.adv.showConsole();IOL.adv.complete=true;IOL.adv.tools.logger("End function. ",classFunc);},setCustomCriteria:function(googletag){var classFunc=IOL.adv.manager.classname+".setCustomCriteria";IOL.adv.tools.timer(classFunc,"Function","start");IOL.adv.tools.logger("Start function",classFunc);var customCriteriaMap={"oe":{condition:typeof document.characterSet==='string',value:document.characterSet,otherwise:"UTF-8"},"optout":{condition:IOL.adv.profile.enable,value:"0",otherwise:"1"},"adv_infocus":{condition:IOL.adv.hasFocus,value:"yes",otherwise:"no"},"adv_np":{condition:IOL.adv.cookie.get('ADV_NP'),value:"yes"},"gdpr":{condition:IOL.adv.getConsentData()!='',value:"1"},"gdpr_consent":{condition:IOL.adv.getConsentData()!='',value:IOL.adv.getConsentData()},"adv_topics":{condition:IOL.adv.topics.length>0,value:IOL.adv.topics},"adv_referrer":{condition:true,value:IOL.adv.referrerLabel},"native":{condition:IOL.adv.pubAdsCfg.native!==false,value:IOL.adv.pubAdsCfg.native},"lotid":{condition:IOL.adv.profile.enable&&IOL.adv.profile.as.value.pid!='',value:IOL.adv.profile.as.value.pid},"laud":{condition:IOL.adv.profile.enable&&IOL.adv.profile.as.value.audienceId.length>0,value:IOL.adv.profile.as.value.audienceId},"xdid_user":{condition:IOL.adv.profile.up.value.ppid.iol,value:"true"},"adv_sso1":{condition:IOL.adv.profile.enable&&IOL.adv.profile.up.value.age,value:IOL.adv.profile.up.value.age,otherwise:"0"},"adv_sso2":{condition:IOL.adv.profile.enable&&IOL.adv.profile.up.value.gender,value:IOL.adv.profile.up.value.gender,otherwise:"0"},"adv_sso3":{condition:IOL.adv.profile.enable&&IOL.adv.profile.up.value.province,value:IOL.adv.profile.up.value.province,otherwise:"0"},"adv_contractcode_exist":{condition:IOL.adv.profile.up.value.ext.mivedo,value:"true"},"adv_contractcode":{condition:IOL.adv.profile.up.value.ext.mivedo,value:IOL.adv.profile.up.value.ext.mivedo}};if(IOL.adv.pubAdsCfg.customCriteria){Object.keys(IOL.adv.pubAdsCfg.customCriteria).forEach(function(k){IOL.adv.tools.logger("Manage client customCriteria: "+k+" value:"+IOL.adv.pubAdsCfg.customCriteria[k],classFunc);if(IOL.adv.pubAdsCfg.customCriteria[k]!==''){customCriteriaMap[k]={condition:false,value:false};customCriteriaMap[k].condition=true;customCriteriaMap[k].value=String(IOL.adv.pubAdsCfg.customCriteria[k]).replace(/\|/g,",");}});}IOL.adv.manager.customCriteria.map=IOL.adv.tools.extend(IOL.adv.manager.customCriteria.map,customCriteriaMap);Object.keys(IOL.adv.manager.customCriteria.map).forEach(function(target){IOL.adv.tools.logger("Manage Target: "+target+" :: condition: "+IOL.adv.manager.customCriteria.map[target].condition+" :: value: "+IOL.adv.manager.customCriteria.map[target].value+" :: otherwise: "+IOL.adv.manager.customCriteria.map[target].otherwise,classFunc);if(IOL.adv.manager.customCriteria.map[target].condition&&IOL.adv.manager.customCriteria.map[target].value!==undefined){var value=String(IOL.adv.manager.customCriteria.map[target].value);googletag.pubads().setTargeting(target,value);IOL.adv.manager.customCriteria.set[target]=value;IOL.adv.tools.logger("Condition is true for Target: "+target+" :: assign value: "+value,classFunc);}else if(IOL.adv.manager.customCriteria.map[target].otherwise){googletag.pubads().setTargeting(target,IOL.adv.manager.customCriteria.map[target].otherwise);IOL.adv.manager.customCriteria.set[target]=IOL.adv.manager.customCriteria.map[target].otherwise;IOL.adv.tools.logger("Condition is false, otherwise is configured for Target: "+target+" :: assign value: "+IOL.adv.manager.customCriteria.map[target].otherwise,classFunc);}else
IOL.adv.tools.logger("Condition is false, otherwise is not configured for Target: "+target+", custom criteria has not been set",classFunc);});IOL.adv.manager.customCriteria.duration=IOL.adv.tools.timer(classFunc,"Function","partial");IOL.adv.tools.logger("End function, Time elapsed is:  "+IOL.adv.tools.timer(classFunc,"Function","partial"),classFunc);},createAds:function(id,idx){var classFunc=IOL.adv.manager.classname+".createAds";IOL.adv.tools.logger("Start function",classFunc);var idx=(idx)?idx:0;var adsLimit=5;try{if(!IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.enable||!id||(idx+1)>adsLimit)return;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id]={};IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].divId=id;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].adUnitPath=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.adUnitPath+"/"+(idx+1);IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].size=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].dynamic.size;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].bidAmazon=true;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].divIdReady=true;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].mediaType='display';IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].sizeIsCompliant=true;IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].forceSafeFrame=false;IOL.adv.tools.logger("Create dynamic ads with id: "+id+", idx: "+idx,classFunc);if(IOL.adv.headerBidding.enable&&IOL.adv.settings.prebidjs.dynamicAdUnits){if(IOL.adv.settings.prebidjs.dynamicAdUnits[idx]){IOL.adv.settings.prebidjs.dynamicAdUnits[idx].code=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id].divId;IOL.adv.settings.prebidjs.adUnits.push(Object.assign({},IOL.adv.settings.prebidjs.dynamicAdUnits[idx]));IOL.adv.tools.logger("Prebid adUnit code found for ads: "+id,classFunc);}else
IOL.adv.tools.logger("Prebid adUnit code not found for ads: "+id,classFunc);}else
IOL.adv.tools.logger("Prebid disabled for ads: "+id,classFunc);IOL.adv.tools.logger("End function",classFunc);}catch(e){}}}}if(!window.iamInitialized){IOL.adv.tools={classname:"IOL.adv.tools",timerContainer:[],logger:function(msg,cFunc,lvl){if(!IOL.adv.debug.log)return;var e="IAM::"+IOL.adv.version+((IOL.adv.settings.ns)?"::"+IOL.adv.settings.ns:"");var lvl=(lvl)?lvl:"info";var m=new Date();var d=m.getUTCFullYear()+"/"+("0"+(m.getUTCMonth()+1)).slice(-2)+"/"+("0"+m.getUTCDate()).slice(-2)+" "+("0"+m.getUTCHours()).slice(-2)+":"+("0"+m.getUTCMinutes()).slice(-2)+":"+("0"+m.getUTCSeconds()).slice(-2)+"."+this.digPadding((m.getUTCMilliseconds()),3);switch(lvl){case"error":console.error("%c"+e+"%c :: ERROR :: "+d+" :: "+cFunc+" :: "+msg,"display: inline-block; color: #fff; background: red; padding: 1px 4px; border-radius: 3px; font-size: x-small","background-color:white; color: #000; font-size: x-small");break;case"warning":console.warn("%c"+e+"%c :: INFO :: "+d+" :: "+cFunc+" :: "+msg,"display: inline-block; color: #fff; background: #3b88c3; padding: 1px 4px; border-radius: 3px; font-size: x-small","background-color:#fff; font-size: x-small");break;case"info":default:console.info("%c"+e+"%c :: INFO :: "+d+" :: "+cFunc+" :: "+msg,"display: inline-block; color: #fff; background: #3b88c3; padding: 1px 4px; border-radius: 3px; font-size: x-small","background-color:#fff; font-size: x-small");break;}},timer:function(classFunc,tag,action){if(!IOL.adv.timer)return;var label=classFunc+"."+tag;if(action=="start"||action=="stop")IOL.adv.tools.timerContainer[label+action]=performance.now();if(action=="partial"){var el=Math.floor(performance.now()-IOL.adv.tools.timerContainer[label+"start"]);IOL.adv.tools.timerContainer[label+action]=el;return el;}if(action=="elapsed")return Math.floor(performance.now());},loadJs:function(f,handleOnError,handleOnLoad,id){var classFunc=IOL.adv.tools.classname+".loadJs";var head=document.head||document.documentElement.childNodes[0];var e=document.createElement('script');e.async=true;e.type='text/javascript';if(id)e.id=id;if(handleOnError)e.onerror=handleOnError;if(handleOnLoad)e.onload=handleOnLoad;var useSSL='https:'==document.location.protocol;e.src=((useSSL||IOL.adv.pubAdsCfg.forceHttps)?'https:':'http:')+f;head.appendChild(e);},documentReady:function(fn){if(document.readyState!='loading'){fn();}else if(document.addEventListener){document.addEventListener('DOMContentLoaded',fn);}else{document.attachEvent('onreadystatechange',function(){if(document.readyState!='loading')fn();});}},divIdsReady:function(ads){var classFunc=IOL.adv.tools.classname+".divIdsReady";var ready=true;Object.keys(ads).forEach(function(id){var ad=ads[id];var optional=(ad.optional===true)?true:false;if(!optional&&ad.divId!==undefined){ad.divIdReady=IOL.adv.tools.divIdReady(ad);ready=ready&&ad.divIdReady;IOL.adv.tools.logger("divId:"+ad.divId+", Optional: "+ad.optional+", Ready: "+ad.divIdReady,classFunc);}else{IOL.adv.tools.logger("divId:"+ad.divId+", Optional: "+ad.optional+", Ready: check is disable for optional ads container",classFunc);}});return ready;},divIdReady:function(ad,getEl){var classFunc=IOL.adv.tools.classname+".divIdReady";var getEl=(getEl)?getEl:false;var ready=false;if(ad.divId){if(typeof ad.divId==='string'){if(getEl)ready=document.getElementById(ad.divId);else
ready=document.getElementById(ad.divId)!==null;}else{var nL=document.querySelectorAll(ad.divId.regex);ready=(nL.length>0)?true:false;}IOL.adv.tools.logger("divId:"+ad.divId+" ready: "+ready,classFunc);}return ready;},divIdSwap:function(width,ads,id){var classFunc=IOL.adv.tools.classname+".divIdSwap";if(width>=ads.divIdSwap.minW&&width<ads.divIdSwap.maxW){IOL.adv.tools.logger(id+" :: start swap ads container",classFunc);if(IOL.adv.settings.prebidjs)if(IOL.adv.settings.prebidjs.adUnits)IOL.adv.settings.prebidjs.adUnits.find(IOL.adv.headerBidding.replaceAdunitByCode,{code:ads.divId,newcode:ads.divIdSwap.divId});IOL.adv.tools.logger(id+" :: override "+ads.divId+" with "+ads.divIdSwap.divId+", minW: "+ads.divIdSwap.minW+" and maxW:"+ads.divIdSwap.maxW+", page width: "+width,classFunc);ads.divIdSwap.divIdOri=ads.divId;ads.divId=ads.divIdSwap.divId;ads.divIdSwap.swapped=true;IOL.adv.tools.logger("Try to set display:none for "+ads.divIdSwap.divIdOri,classFunc);if(document.getElementById(ads.divIdSwap.divIdOri)){document.getElementById(ads.divIdSwap.divIdOri).style.display='none';IOL.adv.tools.logger("set display:none for "+ads.divIdSwap.divIdOri,classFunc);}else
IOL.adv.tools.logger(ads.divIdSwap.divIdOri+" does not exist or is not ready yet",classFunc);if(document.getElementById(ads.divId)){document.getElementById(ads.divId).style.display='block';IOL.adv.tools.logger("set display:block for "+ads.divId,classFunc);}else
IOL.adv.tools.logger(ads.divId+" does not exist or is not ready yet",classFunc);}else{IOL.adv.tools.logger(id+" :: swap ads container not required, set display:none on swap container: "+ads.divIdSwap.divId+" ,minW: "+ads.divIdSwap.minW+" and maxW:"+ads.divIdSwap.maxW+", page width: "+width,classFunc);IOL.adv.tools.logger("Try to set display:none for "+ads.divIdSwap.divId,classFunc);if(document.getElementById(ads.divIdSwap.divId)){document.getElementById(ads.divIdSwap.divId).style.display='none';IOL.adv.tools.logger("set display:none for "+ads.divIdSwap.divId,classFunc);}else
IOL.adv.tools.logger(ads.divIdSwap.divId+" does not exist or is not ready yet",classFunc);ads.divIdSwap.swapped=false;}},validRangeSize:function(width,ads,id){var classFunc=IOL.adv.tools.classname+".validRangeSize";var extraDivIdToHide=false;ads.sizeIsCompliant=false;Object.keys(ads.validRangeSize).forEach(function(vKey){IOL.adv.tools.logger(id+" :: check validRangeSize for "+vKey,classFunc);var v=ads.validRangeSize[vKey];if(v){IOL.adv.tools.logger(id+" :: validRangeSize requested for "+vKey+" with minW: "+v.minW+" and maxW: "+v.maxW,classFunc);if(!(width>=v.minW&&width<=v.maxW)){IOL.adv.tools.logger(id+" :: page width "+width+" is not compliant with min: "+v.minW+" and max: "+v.maxW,classFunc);v.isCompliant=false;if(v.extraDivIdToHide)extraDivIdToHide=v.extraDivIdToHide;}else{IOL.adv.tools.logger(id+" :: page width "+width+" is compliant with min: "+v.minW+" and max: "+v.maxW,classFunc);v.isCompliant=true;}}ads.sizeIsCompliant=ads.sizeIsCompliant||v.isCompliant;});if(!ads.sizeIsCompliant){IOL.adv.tools.logger(id+" :: page width is not compliant with validRangeSize, destroy ads",classFunc);if(document.getElementById(ads.divId)){document.getElementById(ads.divId).style.display='none';IOL.adv.tools.logger(id+" set display:none for "+ads.divId,classFunc);}if(extraDivIdToHide){IOL.adv.tools.logger(id+" set display:none for "+extraDivIdToHide,classFunc);if(document.getElementById(extraDivIdToHide))document.getElementById(extraDivIdToHide).style.display='none';}if(IOL.adv.settings.prebidjs)if(IOL.adv.settings.prebidjs.adUnits)IOL.adv.settings.prebidjs.adUnits=IOL.adv.settings.prebidjs.adUnits.filter(IOL.adv.headerBidding.filterAdunitByCode,{code:ads.divId});delete IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];}else{IOL.adv.tools.logger(id+" :: page width is compliant with validRangeSize",classFunc);}},setAdunitPathByBidderCode:function(ad,bidder){var classFunc=IOL.adv.tools.classname+".setAdunitPathByBidderCode";var adUnit=false;IOL.adv.tools.logger("Start setAdunitPathByBidderCode on "+ad.divId+" for bidder: "+bidder,classFunc);if(IOL.adv.settings.prebidjs){var adUnit=IOL.adv.settings.prebidjs.adUnits.filter(IOL.adv.headerBidding.getAdunitByCode,{code:ad.divId});if(adUnit.length>0){adUnit.find(IOL.adv.headerBidding.setAdunitPathByBidderCode,{'bidder':bidder,'adUnitPath':ad.adUnitPath});IOL.adv.tools.logger("adUnit value after setAdunitPathByBidderCode : "+JSON.stringify(adUnit),classFunc);}else
IOL.adv.tools.logger("No setAdunitPathByBidderCode is required for "+ad.divId,classFunc);}else
IOL.adv.tools.logger("No setAdunitPathByBidderCode is required for "+ad.divId,classFunc);return;},displayAds:function(p){var classFunc=IOL.adv.tools.classname+".displayAds";if(IOL.adv.pubAdsCfg.deferredDisplay){IOL.adv.tools.logger("deferredDisplay is enable, nothing to do",classFunc);return;}var slotContainer=(typeof p!=='undefined')?((typeof p.slotContainer!=='undefined')?p.slotContainer:false):false;var slotId=(typeof p!=='undefined')?((typeof p.slotId!=='undefined')?p.slotId:false):false;var mode=(typeof p!=='undefined')?((typeof p.mode!=='undefined')?p.mode:"standard"):"standard";var changeCorrelator=(typeof p!=='undefined')?((typeof p.changeCorrelator!=='undefined')?p.changeCorrelator:true):true;IOL.adv.tools.logger("slotId:"+slotId+", mode:"+mode+", changeCorrelator:"+changeCorrelator,classFunc);switch(mode){case"display-slots":case"refresh-slots":if(slotContainer)googletag.pubads().refresh(slotContainer);else{var i=0;var l=Object.keys(IOL.adv.manager.slotsContainer).length-1;var a=[];Object.keys(IOL.adv.manager.slotsContainer).forEach(function(id){a[i]=IOL.adv.manager.slotsContainer[id];i++;});googletag.pubads().refresh(a,{changeCorrelator:changeCorrelator});}break;case"display-refresh-single":if(slotId){googletag.display(IOL.adv.manager.slotsContainer[slotId].getSlotElementId());googletag.pubads().refresh([IOL.adv.manager.slotsContainer[slotId]],{changeCorrelator:changeCorrelator});}break;case"refresh-single":if(slotId){googletag.pubads().refresh([IOL.adv.manager.slotsContainer[slotId]],{changeCorrelator:changeCorrelator});}break;case"display-refresh-all":if(slotId){googletag.display(IOL.adv.manager.slotsContainer[slotId].getSlotElementId());var i=0;var l=Object.keys(IOL.adv.manager.slotsContainer).length-1;var a=[];Object.keys(IOL.adv.manager.slotsContainer).forEach(function(id){a[i]=IOL.adv.manager.slotsContainer[id];i++;});googletag.pubads().refresh(a,{changeCorrelator:changeCorrelator});}break;case"display-single":default:if(slotId)googletag.display(IOL.adv.manager.slotsContainer[slotId].getSlotElementId());break;}try{if(typeof IamCallbackDfpCall==="function"){IOL.adv.tools.logger("Hook IamCallbackDfpCall",classFunc);IamCallbackDfpCall();}}catch(e){}IOL.adv.tools.logger("ads display order called",classFunc);},remoteCall:function(url,data,withCredentials,fn){var classFunc=IOL.adv.tools.classname+".remoteCall";try{var x=new XMLHttpRequest();if(fn){x.onreadystatechange=function(){if(x.readyState===XMLHttpRequest.DONE&&x.status===200){fn(x.responseText);}};}var useSSL='https:'==document.location.protocol;url=((useSSL||IOL.adv.pubAdsCfg.forceHttps)?'https:':'http:')+url;x.open("POST",url,true);x.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");x.datatype="json";if(withCredentials)x.withCredentials=withCredentials;x.timeout=10000;x.send(data);}catch(e){this.logger("err remoteCall e:"+e.message,classFunc);}},getDomain:function(s){var d=s.split('.');if(d.length>2)d.shift();return'.'+d.join('.');},getParameterByName:function(name){var res=new RegExp('[\?&]'+name.replace(/\[/g,'\\\[').replace(/\]/g,'\\\]')+'(?:=([^&#]*))?(?:[&#]|$)').exec(window.location.search);return res?(res[1]?decodeURIComponent(res[1].replace(/\+/g,' ')):''):null;},extend:function(obj,src){for(var key in src){if(src.hasOwnProperty(key))obj[key]=src[key];}return obj;},digPadding:function(number,digits){return Array(Math.max(digits-String(number).length+1,0)).join(0)+number;},getMetaTag:function(n,s){var v=[];try{var m=document.getElementsByTagName('meta')[n];if(m!=undefined){m=m.getAttribute("content");if(m!=undefined){if(s){m=m.split(s).filter(function(e){if(e)return true;});for(var i=0;i<m.length;i++){var val=m[i].replace(/\s/g,'')
if(val!='')v[i]=m[i].trim();}}else
v=m;}}}catch(e){}finally{return((v!=undefined)?v:false);}},getReferrerLabel:function(r,d){var classFunc=IOL.adv.tools.classname+".getReferrerLabel";var v=d;var map={'site':['.*'+IOL.adv.domain.replace(/\./g,'\\.')+'$'],'search':[/arianna\.libero\.it$/,/ricerca.*\.virgilio\.it$/,/.*\.google\.[a-z]{2,3}$/,/.*\.bing\.com$/,/.*\.ask\.[a-z]{2,3}$/,/.*\.hotbot\.[a-z]{2,3}$/,/.*\.dogpile\.[a-z]{2,3}$/,/.*\.lycos\.[a-z]{2,3}$/,/.*\.yandex\.[a-z]{2,3}$/,/.*\.exalead\.[a-z]{2,3}$/,/.*\.gigablast\.[a-z]{2,3}$/,/.*\.yahoo\.[a-z]{2,3}$/,/.*\.sogou\.[a-z]{2,3}$/,/.*\.search\.[a-z]{2,3}$/,/.*\.duckduckgo\.[a-z]{2,3}$/,/.*\.istella\.[a-z]{2,3}$/,/.*\.qwant\.[a-z]{2,3}$/,/.*\.searx\.[a-z]{2,3}$/,/.*\.qwant\.[a-z]{2,3}$/],'linked':[/.*\.italiaonline\.it$/,/.*\.virgilio\.it$/,/.*\.libero\.it$/,/.*\.buonissimo\.it$/,/.*\.dilei\.it$/,/.*\.quifinanza\.it$/,/.*\.siviaggia\.it$/,/.*\.supereva\.it$/,/.*\.myblog\.it$/,/.*\.xoom\.it$/,/.*\.initalia\.it$/,/.*\.paginebianche\.it$/,/.*\.paginegialle\.it$/,/.*\.tuttocitta\.it$/,/.*\.seat\.it$/]};IOL.adv.tools.logger("page domain: "+IOL.adv.domain+", referrer: "+r,classFunc);try{var refDomain=(new URL(r)).hostname.toLowerCase();refDomain=((!refDomain.startsWith('.'))?'.'+refDomain:refDomain);IOL.adv.tools.logger("Referrer domain: "+refDomain,classFunc);var found=false;Object.keys(map).forEach(function(k){for(var i=0;i<map[k].length&&v==d;i++){IOL.adv.tools.logger("Apply regEx: "+map[k][i]+" on domain: "+refDomain+" for case: "+k,classFunc);if(refDomain.match(map[k][i])){v=k;IOL.adv.tools.logger("Match found, assign label: "+v,classFunc);}}});}catch(e){IOL.adv.tools.logger("Referrer url is empty, return the default value: "+v,classFunc);}finally{return v;}},find:function(needle,haystack){var classFunc=IOL.adv.tools.classname+".setOptionalCustomParams";var found='';IOL.adv.tools.logger("needle:"+needle+" haystack:"+JSON.stringify(haystack),classFunc);if(needle&&haystack){IOL.adv.tools.logger("try to find needle in haystack",classFunc);found=((haystack[needle])?haystack[needle]:'');}IOL.adv.tools.logger("found: "+found,classFunc);return found;},filterArrayInArray:function(v){var classFunc=IOL.adv.tools.classname+".filterArrayInArray";var ret=true;this.list.forEach(function(prop){IOL.adv.tools.logger("prop:"+prop+" typeof v:"+typeof v+" value: "+v,classFunc);if(typeof v==="object"){if(v.join('x')==prop.join('x')){IOL.adv.tools.logger("Bad size found",classFunc);ret=false;}}else{IOL.adv.tools.logger("Bad size found or not managed",classFunc);ret=false;}});return ret;},track:function(){var classFunc=IOL.adv.tools.classname+".track";setTimeout(function(){IOL.adv.tools.logger("Start tracking, time threshold: "+IOL.adv.track.threshold+" ms, started after: "+IOL.adv.track.startAfter+" ms",classFunc);var count=0;var e=window.performance.getEntries();for(var i in e){var d=e[i].duration;if(d>IOL.adv.track.threshold&&(e[i].name!=window.location.href)){count++;IOL.adv.trackingMsg=IOL.adv.version+"::"+classFunc+"::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::"+encodeURIComponent(e[i].name)+"::slow::"+d;IOL.adv.tools.logger(IOL.adv.trackingMsg,classFunc);IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.track.remoteHandler,"d="+IOL.adv.domain+"&lv=warning&msg="+IOL.adv.trackingMsg);}}IOL.adv.tools.logger("End tracking, count of slow resources: "+count,classFunc);},IOL.adv.track.startAfter);},randomId:function(){var f=function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};return(f()+f()+f()+f()+f()+f()+f()+f());},reloadPageInDebugMode:function(){var _url=location.href;_url=(_url.indexOf('?')!==-1)?_url+'&iam_console={"log":true}':_url+'?iam_console={"log":true}';window.location.href=_url;},reloadPageWithConsole:function(){var _url=location.href;_url=(_url.indexOf('?')!==-1)?_url+'&iam_console={"console":true}':_url+'?iam_console={"console":true}';window.location.href=_url;}}}if(!window.iamInitialized){IOL.adv.cookie={get:function(name){var ret=false;var aCookieName=name.split(',');var aCookie=document.cookie.split(';');var l=aCookie.length;for(var j=0;j<aCookieName.length;j++){var nameEQ=aCookieName[j]+"=";for(var i=0;i<l;i++){var c=aCookie[i];while(c.charAt(0)==' '){c=c.substring(1,c.length);}if(c.indexOf(nameEQ)===0){ret=c.substring(nameEQ.length,c.length);}}}return ret;},getProfileEnable:function(a){for(var b="DataRecs geo vlocal Advertising tmp1 tmp2 af xedge".split(" "),d="",c=document.cookie.split(";"),h=0;h<c.length;h++){for(var l=c[h];" "==l.charAt(0);)l=l.substring(1,l.length);0==l.indexOf("policy_cookie=")&&(d=l.substring(14,l.length))}if(null!=d&&""!=d){d=d.split("_")[0];c=null;for(index=0;index<b.length;++index)if(b[index]==a){c=index;break}a=null!=c?d.charAt(c):null}else return!0;return"1"==a?!0:!1;},set:function(cName,cValue,cDays,cPath){var expires=new Date();expires.setDate(expires.getDate()+cDays);document.cookie=cName+"="+escape(cValue)+((cDays===null)?"":"; expires="+expires.toUTCString())+"; Secure; SameSite=Strict; path="+((typeof cPath==="undefined")?"/":cPath)+"; domain="+IOL.adv.domain;},erase:function(cName){this.set(cName,"",-1);},enabled:function(){this.set(IOL.adv.domain,"probe","ok",1);var enabled=this.get("probe")=='ok';this.set(IOL.adv.domain,"probe","",-1);return enabled;}}}if(!window.iamInitialized){IOL.adv.headerBidding={classname:"IOL.adv.headerBidding",enable:true,hbTimeout:1600,bidderTimeout:1500,displayAfterPrestitial:false,displayAfterSlotSwitch:false,bidders:[],requestManager:{adServerRequestSent:false,timer:false,timedOut:false},amazon:{id:'amazon',enable:false,init:false,pubID:'3204',adServer:'googletag',slotsDisplay:[],slotsVideo:[],slots:[],excludeSizes:[[1,1],[320,100],[336,250],[336,280],[728,1],[970,270]],videoAdServer:'DFP',videoBid:''},onetag:{id:'onetag',enable:false,pubID:'389a1a1c29',slots:[],videoBid:''},prebidjs:{id:'prebidjs',enable:false,adUnits:[],customConfigObject:{"buckets":[{"precision":2,"max":3,"increment":0.01},{"precision":2,"max":8,"increment":0.05},{"precision":2,"max":20,"increment":0.5},{"precision":2,"max":30,"increment":1}]},customSizeConfig:[{'mediaQuery':'(min-width: 1025px)','sizesSupported':[[1800,1000],[1200,90],[970,250],[970,90],[728,90],[300,600],[300,250],[100,200],[1,1]],'labels':['desktop']},{'mediaQuery':'(min-width: 766px) and (max-width: 1024px)','sizesSupported':[[728,90],[300,250],[100,200],[1,1]],'labels':['tablet']},{'mediaQuery':'(min-width: 320px) and (max-width: 765px)','sizesSupported':[[300,50],[320,50],[320,100],[300,250],[100,200],[1,1]],'labels':['mobile']}]},init:function(ads,adUnits){var classFunc=IOL.adv.headerBidding.classname+".init";IOL.adv.tools.logger("Start function",classFunc);IOL.adv.headerBidding.enable=false;IOL.adv.headerBidding.amazon.enable=false;IOL.adv.headerBidding.amazon.slots=[];IOL.adv.headerBidding.amazon.slotsVideo=[];IOL.adv.headerBidding.amazon.slotsDisplay=[];IOL.adv.headerBidding.amazon.videoBid='';IOL.adv.headerBidding.prebidjs.enable=false;IOL.adv.headerBidding.prebidjs.adUnits=[];IOL.adv.headerBidding.onetag.enable=false;IOL.adv.headerBidding.onetag.slots=[];IOL.adv.headerBidding.onetag.videoBid='';IOL.adv.headerBidding.bidders=[];IOL.adv.headerBidding.requestManager={};IOL.adv.headerBidding.requestManager.adServerRequestSent=false;IOL.adv.headerBidding.requestManager.timedOut=false;if(!IOL.adv.pubAdsCfg.prebid){IOL.adv.tools.logger("HeaderBidding is disabled by the client.",classFunc);return;}switch(IOL.adv.connectionType){case"3g":IOL.adv.headerBidding.hbTimeout=2600;IOL.adv.headerBidding.bidderTimeout=2500;break;case"2g":IOL.adv.headerBidding.hbTimeout=6100;IOL.adv.headerBidding.bidderTimeout=6000;break;default:break;}IOL.adv.tools.logger("Set hbTimeout:"+IOL.adv.headerBidding.hbTimeout+", bidderTimeout:"+IOL.adv.headerBidding.bidderTimeout,classFunc);Object.keys(ads).forEach(function(key){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[key];if(ad.mediaType=='video')IOL.adv.manager.videoAds=true;});if(Object.keys(ads).length==1&&IOL.adv.manager.videoAds){IOL.adv.manager.videoOnly=true;IOL.adv.tools.logger("This slot contains a single ads with mediaType video",classFunc);}IOL.adv.tools.logger("HeaderBidding, start compliance check for Amazon.",classFunc);if(typeof apstag!=='undefined'){Object.keys(ads).forEach(function(key){var ad=ads[key];var sizes=[];if(ad.size)sizes=ad.size.filter(IOL.adv.tools.filterArrayInArray,{'list':IOL.adv.headerBidding.amazon.excludeSizes});IOL.adv.tools.logger("HeaderBidding Amazon for "+key+" ::"+" ad.sizeIsCompliant:"+ad.sizeIsCompliant+" ad.mediaType:"+ad.mediaType+" ad.divIdReady:"+ad.divIdReady+" ad.bidAmazon:"+ad.bidAmazon+" sizes:"+sizes,classFunc);if(ad.bidAmazon&&ad.sizeIsCompliant&&ad.divIdReady&&sizes.length>0){IOL.adv.tools.logger("HeaderBidding Amazon enable for "+key,classFunc);if(ad.mediaType=="display"){IOL.adv.headerBidding.amazon.slotsDisplay.push({slotID:ad.divId,slotName:ad.adUnitPath,sizes:sizes});}if(ad.mediaType=="video"){IOL.adv.headerBidding.amazon.slotsVideo.push({slotID:'videoSlot',mediaType:'video'});}}});IOL.adv.headerBidding.amazon.slots=IOL.adv.headerBidding.amazon.slotsDisplay.concat(IOL.adv.headerBidding.amazon.slotsVideo);if(IOL.adv.headerBidding.amazon.slots.length>0){IOL.adv.headerBidding.amazon.enable=true;IOL.adv.headerBidding.bidders.push(IOL.adv.headerBidding.amazon.id);if(!IOL.adv.headerBidding.amazon.init){apstag.init({pubID:IOL.adv.headerBidding.amazon.pubID,adServer:IOL.adv.headerBidding.amazon.adServer,videoAdServer:IOL.adv.headerBidding.amazon.videoAdServer,gdpr:{enabled:IOL.adv.gdpr.enable,consent:IOL.adv.gdpr.consentData}});IOL.adv.headerBidding.amazon.init=true;}IOL.adv.tools.logger("HeaderBidding amazon compliant and initialized.",classFunc);}}else
IOL.adv.tools.logger("HeaderBidding amazon: apstag is not defined",classFunc);IOL.adv.tools.logger("HeaderBidding amazon enable: "+IOL.adv.headerBidding.amazon.enable,classFunc);IOL.adv.tools.logger("HeaderBidding, start compliance check for prebidjs.",classFunc);if(typeof pbjs!=='undefined'&&adUnits.length>0){IOL.adv.headerBidding.prebidjs.enable=true;IOL.adv.headerBidding.bidders.push(IOL.adv.headerBidding.prebidjs.id);pbjs.removeAdUnit();IOL.adv.headerBidding.prebidjs.adUnits=adUnits;pbjs.bidderSettings={ias:{alwaysUseBid:true,sendStandardTargeting:false,suppressEmptyKeys:true,adserverTargeting:[{key:'adt',val:function(bidResponse){return bidResponse.adt;}},{key:'alc',val:function(bidResponse){return bidResponse.alc;}},{key:'dlm',val:function(bidResponse){return bidResponse.dlm;}},{key:'drg',val:function(bidResponse){return bidResponse.drg;}},{key:'hat',val:function(bidResponse){return bidResponse.hat;}},{key:'off',val:function(bidResponse){return bidResponse.off;}},{key:'vio',val:function(bidResponse){return bidResponse.vio;}},{key:'fr',val:function(bidResponse){return bidResponse.fr;}},{key:'id',val:function(bidResponse){var match=bidResponse.slots[bidResponse.adUnitCode];return match.id;}},{key:'vw',val:function(bidResponse){var match=bidResponse.slots[bidResponse.adUnitCode];return match.vw;}},{key:'grm',val:function(bidResponse){var match=bidResponse.slots[bidResponse.adUnitCode];return match.grm;}},{key:'pub',val:function(bidResponse){var match=bidResponse.slots[bidResponse.adUnitCode];return match.pub;}},]}};pbjs.que.push(function(){IOL.adv.tools.logger("HeaderBidding prebidjs, Start pbjs.que.push",classFunc);var gdpr={gdpr:{cmpApi:'iab',timeout:1400,allowAuctionWithoutConsent:true}};if(IOL.adv.settings.cmpApi=='static'){gdpr={gdpr:{cmpApi:'static',timeout:1400,allowAuctionWithoutConsent:true,consentData:{getConsentData:{'gdprApplies':true,'hasGlobalScope':false,'consentData':IOL.adv.gdpr.consentData},getVendorConsents:{'metadata':IOL.adv.gdpr.consentData}}}};}pbjs.setConfig({enableSendAllBids:true,priceGranularity:IOL.adv.headerBidding.prebidjs.customConfigObject,currency:{"adServerCurrency":"USD"},sizeConfig:IOL.adv.headerBidding.prebidjs.customSizeConfig,userSync:{filterSettings:{iframe:{bidders:'*',filter:'include'},image:{bidders:'*',filter:'include'}},syncsPerBidder:3,syncDelay:6000},bidderTimeout:IOL.adv.headerBidding.bidderTimeout,rubicon:{singleRequest:true},improvedigital:{usePrebidSizes:true,singleRequest:true},consentManagement:gdpr});if(IOL.adv.manager.videoAds)pbjs.setConfig({cache:{url:'https://prebid.adnxs.com/pbc/v1/cache'}});pbjs.addAdUnits(IOL.adv.headerBidding.prebidjs.adUnits);IOL.adv.tools.logger("HeaderBidding prebidjs compliant and initialized.",classFunc);});}else
IOL.adv.tools.logger("HeaderBidding prebidjs: pbjs is not defined or adUnits is empty",classFunc);IOL.adv.tools.logger("HeaderBidding prebidjs enable: "+IOL.adv.headerBidding.prebidjs.enable,classFunc);IOL.adv.tools.logger("HeaderBidding, start compliance check for OneTag.",classFunc);if(typeof _onetag!=='undefined'){var up=IOL.adv.getProfile();Object.keys(ads).forEach(function(key){var ad=ads[key];IOL.adv.tools.logger("HeaderBidding OneTag for "+key+" ::"+" ad.sizeIsCompliant: "+ad.sizeIsCompliant+" ad.mediaType: "+ad.mediaType+" ad.divIdReady: "+ad.divIdReady+" ad.bidOneTag: "+ad.bidOneTag,classFunc);if(ad.bidOneTag&&ad.sizeIsCompliant&&ad.divIdReady){IOL.adv.headerBidding.onetag.enable=true;IOL.adv.headerBidding.bidders.push(IOL.adv.headerBidding.onetag.id);IOL.adv.headerBidding.onetag.slots.push({id:'videoSlot',type:"video",adServerUrl:'',pubId:IOL.adv.headerBidding.onetag.pubID,customData:{"adv_sso1":up.age,"adv_sso2":up.gender}});}});IOL.adv.tools.logger("HeaderBidding onetag compliant and initialized.",classFunc);}else
IOL.adv.tools.logger("HeaderBidding onetag: _onetag is not defined",classFunc);IOL.adv.tools.logger("HeaderBidding onetag enable: "+IOL.adv.headerBidding.onetag.enable,classFunc);IOL.adv.headerBidding.bidders.forEach(function(bidder){IOL.adv.headerBidding.requestManager[bidder]=false;});if(IOL.adv.headerBidding.bidders.length>0){IOL.adv.settings.disableInitialLoad=true;IOL.adv.headerBidding.enable=true;}else{IOL.adv.headerBidding.enable=false;IOL.adv.settings.disableInitialLoad=false;}IOL.adv.tools.logger("HeaderBidding enable: "+IOL.adv.headerBidding.enable,classFunc);IOL.adv.tools.logger("End function",classFunc);},run:function(callback){var classFunc=IOL.adv.headerBidding.classname+".run";IOL.adv.tools.logger("Start function",classFunc);if(IOL.adv.headerBidding.amazon.enable){IOL.adv.tools.logger("Start fetchBids amazon.",classFunc);apstag.fetchBids({slots:IOL.adv.headerBidding.amazon.slots,timeout:IOL.adv.headerBidding.bidderTimeout},function(bids){IOL.adv.tools.logger("HeaderBidding amazon response: "+JSON.stringify(bids),classFunc);var videoBid=bids.filter(function(bid){return bid.mediaType==='video';})[0];if(videoBid){IOL.adv.headerBidding.setAmazonVideoBid(videoBid.encodedQsParams);IOL.adv.tools.logger("HeaderBidding amazon videoBid: "+IOL.adv.headerBidding.amazon.videoBid,classFunc);}if(!IOL.adv.manager.videoOnly){googletag.cmd.push(function(){apstag.setDisplayBids();});}IOL.adv.headerBidding.headerBidderBack(IOL.adv.headerBidding.amazon.id,callback);});}else
IOL.adv.tools.logger("HeaderBidding amazon is disable.",classFunc);if(IOL.adv.headerBidding.prebidjs.enable){IOL.adv.tools.logger("Start fetchBids prebidjs.",classFunc);pbjs.requestBids({timeout:IOL.adv.headerBidding.bidderTimeout,bidsBackHandler:function(bidResponses){IOL.adv.tools.logger("HeaderBidding pbjs response: "+JSON.stringify(bidResponses),classFunc);IOL.adv.headerBidding.headerBidderBack(IOL.adv.headerBidding.prebidjs.id,callback);}});IOL.adv.tools.logger("HeaderBidding prebidjs, End pbjs.que.push",classFunc);}else
IOL.adv.tools.logger("HeaderBidding prebidjs is disable.",classFunc);if(IOL.adv.headerBidding.onetag.enable){IOL.adv.tools.logger("Start fetchBids oneTag.",classFunc);_onetag.cmd.push(function(){_onetag.fastBidRequest({responseFormat:"map",adSpaces:IOL.adv.headerBidding.onetag.slots}).then(function(fastBidResponse){IOL.adv.headerBidding.onetag.response=fastBidResponse;IOL.adv.tools.logger("HeaderBidding onetag response: "+JSON.stringify(IOL.adv.headerBidding.onetag.response),classFunc);if(IOL.adv.headerBidding.onetag.response.bids.videoSlot)IOL.adv.headerBidding.setOnetagVideoBid(encodeURIComponent("&"+((IOL.adv.headerBidding.onetag.response.bids.videoSlot.priceKey&&IOL.adv.headerBidding.onetag.response.bids.videoSlot.priceValue)?IOL.adv.headerBidding.onetag.response.bids.videoSlot.priceKey+"="+IOL.adv.headerBidding.onetag.response.bids.videoSlot.priceValue:'')+((IOL.adv.headerBidding.onetag.response.bids.videoSlot.invocation)?"&onetag_invocation="+IOL.adv.headerBidding.onetag.response.bids.videoSlot.invocation:'')+((IOL.adv.headerBidding.onetag.response.bids.videoSlot.dealId)?"&onetag_deal="+IOL.adv.headerBidding.onetag.response.bids.videoSlot.dealId:'')));IOL.adv.headerBidding.headerBidderBack(IOL.adv.headerBidding.onetag.id,callback);});});}else
IOL.adv.tools.logger("HeaderBidding onetag is disable.",classFunc);if(IOL.adv.headerBidding.enable){IOL.adv.headerBidding.requestManager.timer=window.setTimeout(function(){IOL.adv.headerBidding.sendAdserverRequest(function(){IOL.adv.headerBidding.adServerRequestTimedOut(callback)});},IOL.adv.headerBidding.hbTimeout);}IOL.adv.tools.logger("End function",classFunc);},adServerRequestTimedOut:function(callback){var classFunc=IOL.adv.headerBidding.classname+".adServerRequestTimedOut";if(IOL.adv.headerBidding.requestManager.timer!==false)IOL.adv.headerBidding.requestManager.timedOut=true;IOL.adv.tools.logger("requestManager.timedOut: "+IOL.adv.headerBidding.requestManager.timedOut,classFunc);try{if(callback){IOL.adv.tools.logger("Run callback in adServerRequestTimedOut "+callback,classFunc);callback();}if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete",classFunc);IamCallbackOnComplete();}}catch(e){}},sendAdserverRequest:function(callback){var classFunc=IOL.adv.headerBidding.classname+".sendAdserverRequest";IOL.adv.tools.logger("Start function",classFunc);if(IOL.adv.headerBidding.requestManager.adServerRequestSent===true){IOL.adv.tools.logger("Request has been already sent, elapsed: "+IOL.adv.tools.timer("IOL.adv",".grandTotal","elapsed")+", adServerRequestSent: "+IOL.adv.headerBidding.requestManager.adServerRequestSent,classFunc);return;}IOL.adv.headerBidding.requestManager.adServerRequestSent=true;clearTimeout(IOL.adv.headerBidding.requestManager.timer);IOL.adv.tools.logger("Request has not been sent, start adServerRequest push",classFunc);if(IOL.adv.manager.videoOnly){IOL.adv.tools.logger("HeaderBidding in videoOnly mode, skip the display strategy, callback: "+callback,classFunc);try{if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete in sendAdserverRequest",classFunc);IamCallbackOnComplete();}}catch(e){}return;}var googletag=window.googletag||{};googletag.cmd=googletag.cmd||[];googletag.cmd.push(function(){clearTimeout(IOL.adv.headerBidding.requestManager.timer);if(IOL.adv.headerBidding.amazon.enable)apstag.setDisplayBids();if(IOL.adv.headerBidding.prebidjs.enable)pbjs.setTargetingForGPTAsync();switch(IOL.adv.mode){case'refresh':IOL.adv.tools.logger("Ads start displayAds after headerBidding in refreshMode",classFunc);IOL.adv.tools.displayAds({slotContainer:IOL.adv.manager.refreshSlotsContainer.slots,mode:"refresh-slots"});break;default:if(IOL.adv.pubAdsCfg.lazy){IOL.adv.tools.logger("Start Lazy loading after header bidding",classFunc);Object.keys(IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads).forEach(function(id){var ad=IOL.adv.settings.slots[IOL.adv.pubAdsCfg.slot].ads[id];if(ad.lazy==false){IOL.adv.tools.logger(ad.divId+", lazy disable for this ads, start display",classFunc);IOL.adv.tools.displayAds({slotId:id,mode:"refresh-single",changeCorrelator:false});}else{IOL.adv.tools.logger(ad.divId+", lazy enabled for this ads, start intersectionObserver",classFunc);var d=IOL.adv.tools.divIdReady(ad,true);if(d){IOL.adv.settings.lazy.observer.obj.observe(d);IOL.adv.settings.lazy.divIdSlotIdMap[ad.divId]=id;}}});}else{if(IOL.adv.headerBidding.displayAfterPrestitial){IOL.adv.tools.logger("Ads start displayAds after headerBidding and prestitial",classFunc);IOL.adv.tools.displayAds({slotId:IOL.adv.manager.lastSlotIdReady,mode:"display-single"});}else if(IOL.adv.headerBidding.displayAfterSlotSwitch){IOL.adv.tools.logger("Ads start displayAds after headerBidding and slotSwitch",classFunc);IOL.adv.tools.displayAds({slotId:IOL.adv.manager.lastSlotIdReady,mode:"refresh-single"});}else{IOL.adv.tools.logger("Ads start displayAds after headerBidding",classFunc);IOL.adv.tools.displayAds({mode:"refresh-slots"});}}}try{googletag.pubads().addEventListener('slotRenderEnded',function(event){if(IOL.adv.track.enable){if(IOL.adv.settings.trackHBCpm){IOL.adv.tools.logger("trackHBCpm: "+IOL.adv.settings.trackHBCpm,classFunc);var cpms={};IOL.adv.settings.trackHBCpm=false;var bids=pbjs.getHighestCpmBids();for(var i=0;i<bids.length;i++){var cpm={};cpm[bids[i].cpm]={"id":bids[i].adUnitCode,"size":bids[i].size,"bidder":bids[i].bidder};cpms=IOL.adv.tools.extend(cpms,cpm)}IOL.adv.tools.logger("CPMS: "+JSON.stringify(cpms),classFunc);var maxCpm=Math.max.apply(null,Object.keys(cpms));if(cpms[maxCpm]){IOL.adv.trackingMsg=IOL.adv.version+"::"+classFunc+"::"+IOL.adv.settings.ns+"::"+IOL.adv.pubAdsCfg.slot+"::"+cpms[maxCpm].id+"."+cpms[maxCpm].size+"::hb.cpm."+cpms[maxCpm].bidder+"::"+maxCpm;IOL.adv.tools.logger(IOL.adv.trackingMsg,classFunc);IOL.adv.tools.remoteCall(IOL.adv.server+IOL.adv.track.remoteHandler,"d="+IOL.adv.domain+"&lv=debug&msg="+IOL.adv.trackingMsg);}}}});if(callback){IOL.adv.tools.logger("Run callback in googletag.cmd.push "+callback,classFunc);callback();}if(typeof IamCallbackOnComplete==="function"){IOL.adv.tools.logger("Hook IamCallbackOnComplete in sendAdserverRequest",classFunc);IamCallbackOnComplete();}}catch(e){}});IOL.adv.tools.logger("End function",classFunc);},allBiddersBack:function(){var classFunc=IOL.adv.headerBidding.classname+".allBiddersBack";var allBiddersBack=IOL.adv.headerBidding.bidders.map(function(bidder){return IOL.adv.headerBidding.requestManager[bidder];}).filter(Boolean).length===IOL.adv.headerBidding.bidders.length;return allBiddersBack;},headerBidderBack:function(bidder,callback){var classFunc=IOL.adv.headerBidding.classname+".headerBidderBack";if(IOL.adv.headerBidding.requestManager.adServerRequestSent===true){return;}IOL.adv.headerBidding.requestManager[bidder]=true;IOL.adv.tools.logger("HeaderBidding requestManager: "+JSON.stringify(IOL.adv.headerBidding.requestManager),classFunc);if(IOL.adv.headerBidding.allBiddersBack()){IOL.adv.tools.logger("HeaderBidding allBiddersBack requestManager: "+JSON.stringify(IOL.adv.headerBidding.requestManager),classFunc);IOL.adv.headerBidding.sendAdserverRequest(callback);}},replaceAdunitByCode:function(e){var classFunc=IOL.adv.headerBidding.classname+".replaceAdunitByCode";try{if(e.code===this.code){e.code=this.newcode;IOL.adv.tools.logger(this.code+" code found, replace prebid adUnit code",classFunc);}else{IOL.adv.tools.logger(this.code+" code does not match "+e.code,classFunc);}}catch(err){return false;}},cloneAdunitByCode:function(e){var classFunc=IOL.adv.headerBidding.classname+".cloneAdunitByCode";try{if(e.code===this.code){var adUnit=Object.assign({},e);adUnit.code=this.newcode;IOL.adv.settings.prebidjs.adUnits.push(adUnit)
IOL.adv.tools.logger(this.code+" code found, prebid adUnit cloned",classFunc);}else{IOL.adv.tools.logger(this.code+" code does not match "+e.code,classFunc);}}catch(err){return false;}},setAdunitPathByBidderCode:function(e){var classFunc=IOL.adv.headerBidding.classname+".setAdunitPathByBidderCode";try{IOL.adv.tools.logger("Managing code: "+e.code+", try to find bidder: "+this.bidder,classFunc);e.bids.forEach(function(v){IOL.adv.tools.logger("Compare bidder ["+v.bidder+"] with ["+this.bidder+"]",classFunc);if(v.bidder==this.bidder){v.params.adUnitPath=this.adUnitPath;IOL.adv.tools.logger(this.bidder+" bidder found, set "+v.params.adUnitPath+" as adUnitPath on "+this.code,classFunc);}else{IOL.adv.tools.logger(v.bidder+" bidder does not match "+this.bidder,classFunc);}},{bidder:this.bidder,adUnitPath:this.adUnitPath,code:e.code});}catch(err){return false;}},filterAdunitByCode:function(e){var classFunc=IOL.adv.headerBidding.classname+".filterAdunitByCode";try{if(e.code===this.code){IOL.adv.tools.logger(this.code+" code found, remove item from prebid adUnit",classFunc);return false;}else{IOL.adv.tools.logger(this.code+" code does not match "+e.code,classFunc);return true;}}catch(err){return true;}},getAdunitByCode:function(e){var classFunc=IOL.adv.headerBidding.classname+".getAdunitByCode";try{if(e.code===this.code){IOL.adv.tools.logger(this.code+" code found, remove item from prebid adUnit",classFunc);return true;}else{IOL.adv.tools.logger(this.code+" code does not match "+e.code,classFunc);}}catch(err){return true;}},findAdunitByMediaType:function(e){var classFunc=IOL.adv.headerBidding.classname+".findAdunitByMediaType";try{if(e.mediaTypes[this.mediaType]){IOL.adv.tools.logger(this.mediaType+" adunit found",classFunc);return true;}else{IOL.adv.tools.logger(this.mediaType+" adunit not found",classFunc);return false;}}catch(err){return false;}},isEnable:function(){var classFunc=IOL.adv.headerBidding.classname+".isEnable";IOL.adv.tools.logger("return: "+IOL.adv.headerBidding.enable,classFunc);return IOL.adv.headerBidding.enable;},isAmazonEnable:function(){var classFunc=IOL.adv.headerBidding.classname+".isAmazonEnable";IOL.adv.tools.logger("return: "+IOL.adv.headerBidding.amazon.enable,classFunc);return IOL.adv.headerBidding.amazon.enable;},isPrebidJsEnable:function(){var classFunc=IOL.adv.headerBidding.classname+".isPrebidJsEnable";IOL.adv.tools.logger("return: "+IOL.adv.headerBidding.prebidjs.enable,classFunc);return IOL.adv.headerBidding.prebidjs.enable;},isOneTagEnable:function(){var classFunc=IOL.adv.headerBidding.classname+".isOneTagEnable";IOL.adv.tools.logger("return: "+IOL.adv.headerBidding.onetag.enable,classFunc);return IOL.adv.headerBidding.onetag.enable;},getAmazonVideoBid:function(){var classFunc=IOL.adv.headerBidding.classname+".getAmazonVideoBid";IOL.adv.tools.logger("return videoBid:"+IOL.adv.headerBidding.amazon.videoBid,classFunc);return IOL.adv.headerBidding.amazon.videoBid;},setAmazonVideoBid:function(v){var classFunc=IOL.adv.headerBidding.classname+".setAmazonVideoBid";IOL.adv.headerBidding.amazon.videoBid=v;IOL.adv.tools.logger("videoBid:"+IOL.adv.headerBidding.amazon.videoBid,classFunc);},getOnetagVideoBid:function(){var classFunc=IOL.adv.headerBidding.classname+".getOnetagVideoBid";IOL.adv.tools.logger("return videoBid:"+IOL.adv.headerBidding.onetag.videoBid,classFunc);return IOL.adv.headerBidding.onetag.videoBid;},setOnetagVideoBid:function(v){var classFunc=IOL.adv.headerBidding.classname+".setOnetagVideoBid";IOL.adv.headerBidding.onetag.videoBid=v;IOL.adv.tools.logger("videoBid:"+IOL.adv.headerBidding.onetag.videoBid,classFunc);},}}if(typeof IOL.adv!='undefined'){try{if(!window.iamInitialized){window.iamInitialized=true;IOL.adv.init(function(){IOL.adv.manager.init(function(){IOL.adv.manager.run()})});}else
IOL.adv.tools.logger("IAM has been already initialized","IOL.adv");}catch(e){}}